import{A as $,b as A,r as o,f as V,j as r,y as i,U as R}from"./index-CD8CbPwS.js";import{S as F}from"./react-papaparse.es-Bjfjzm6R.js";import{A as T}from"./AsyncButton-uaaMPnEN.js";import"./Icons-QOAE5RoN.js";import"./index-Czl2LD_p.js";import"./index-CMepVOqn.js";const q=()=>{const{can:u}=$(),m=A(),[L,j]=o.useState(!0),c=["tipo_jurisprudencia","restrictor","ratio","descriptor","id_resolucion","descriptor_id","restrictor_id","root_id"],[v,p]=o.useState(!1),{readString:S}=F(),[h,g]=o.useState([]),[d,x]=o.useState([]),[k,f]=o.useState([]),[b,n]=o.useState(null),[y,w]=o.useState(null),N=(s,e)=>{const t=Math.ceil(20);return[...s].sort(()=>.5-Math.random()).slice(0,t)},E=s=>{g([]),x([]),f(0),n(null),S(s,{worker:!0,delimiter:",",skipEmptyLines:!0,header:!0,complete:e=>{if(e.errors.length>0)n("Error al procesar el archivo CSV"),console.error(e.errors);else{const t=Object.keys(e.data[0]);if(console.log("Resultados:",t),t.length!==c.length){n(`El archivo CSV debe tener ${c.length} columnas. Actualmente tiene ${t.length}.`);return}if(!c.every(l=>t.includes(l))){n(`El archivo CSV debe contener las siguientes columnas: ${c.join(", ")}.`);return}n(null),f(e.data.length);const a=N(e.data);if(x(a),e.data.length>0){const l=Object.keys(e.data[0]).map(_=>({field:_,sortable:!0,resizable:!0,flex:1}));g(l)}}}})},C=s=>{const e=s.target.files[0];if(e){const t=new FileReader;t.onload=a=>{const l=a.target.result;E(l)},t.onerror=()=>{n("No se pudo leer el archivo CSV")},t.readAsText(e),w(e)}else n("No se seleccionó ningún archivo")},D=async()=>{if(!y){i.warning("Por favor, selecciona un archivo antes de continuar.");return}p(!0);const s=new FormData;s.append("excelFile",y),R.subirJurisprudencia(s).then(({data:e})=>{if(e.success){const t=e.mensaje||"Datos cargados exitosamente.",a=`Total de registros procesados: ${e.total_records}, Registros omitidos: ${e.skipped_records}`;i.success(`${t} ${a}`),console.log("Resultado:",e)}else i.warning(e.mensaje||"El servidor no pudo completar la operación.")}).catch(e=>{if(console.error("Error al realizar la solicitud:",e),e.response){const{status:t,data:a}=e.response;console.error(`Error ${t}:`,a),a.error?i.error(a.error):i.error("Ocurrió un error en el servidor.")}else e.request?i.error("No se pudo contactar al servidor. Por favor, inténtalo más tarde."):i.error(`Error inesperado: ${e.message}`)}).finally(()=>{p(!1)})};return V(),o.useEffect(()=>{u("subir_jurisprudencia")?j(!1):m("/")},[u,m]),r.jsx("div",{className:"flex flex-col justify-center items-center",children:r.jsxs("div",{children:[r.jsx("label",{className:"text-2xl font-extrabold dark:text-white",htmlFor:"file_input",children:"Subir jurisprudencia en CSV"}),r.jsx("input",{accept:".csv",onChange:C,className:`block my-4 p-4 w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer\r
 bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600\r
  dark:placeholder-gray-400`,id:"file_input",type:"file"}),b&&r.jsx("p",{style:{color:"red"},children:b}),d.length>0&&r.jsxs("div",{children:[r.jsx("h3",{className:"py-4 text-sm roboto-bold dark:text-white",children:"Vista previa del contenido"}),r.jsxs("h4",{className:"py-4 text-sm dark:text-white",children:[k," filas encontradas"]}),d.length>0&&r.jsx("div",{className:"overflow-x-auto lg:max-w-[1200px] md:max-w-[500px] sm:max-w-[400px] max-w-[90dvw]",children:r.jsxs("table",{className:"table-auto border-collapse",children:[r.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:r.jsx("tr",{children:h.map(s=>r.jsx("th",{className:"p-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border-b dark:border-gray-600",children:s.field},s.field))})}),r.jsx("tbody",{children:d.map((s,e)=>r.jsx("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700",children:h.map(t=>r.jsx("td",{className:"p-3 text-sm text-gray-800 dark:text-gray-200 max-w-[200px] truncate whitespace-nowrap",title:s[t.field],children:s[t.field]},t.field))},e))})]})}),r.jsx("div",{className:"p-4 m-4 flex justify-end",children:r.jsx("div",{children:r.jsx(T,{asyncFunction:D,isLoading:v,name:"Subir"})})})]})]})})};export{q as default};
