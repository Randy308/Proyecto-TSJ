import{u as V,c as $,r as n,j as a,L as F,y as c,U as L}from"./index-CS51DAse.js";import{S as z}from"./react-papaparse.es-BLGhBF7Q.js";import{A as R}from"./AsyncButton-O7CY9z2J.js";import"./Icons-Beyyzlav.js";import"./index-BBE9PvKj.js";import"./index-Bjhrrt2E.js";const P=()=>{const{can:h}=V(),p=$(),[v,S]=n.useState(!0),l=["id","nro_resolucion","nro_expediente","fecha_emision","fecha_publicacion","tipo_resolucion","departamento","id_sala","sala","magistrado","forma_resolucion","proceso","precedente","demandante","demandado","id_tema","maxima","sintesis","contenido"],[k,d]=n.useState(!1),{readString:w}=z(),[x,g]=n.useState([]),[u,f]=n.useState([]),[N,b]=n.useState(0),[y,s]=n.useState(null),[j,C]=n.useState(null),_=t=>{const e=Math.ceil(20);return[...t].sort(()=>.5-Math.random()).slice(0,e)},E=t=>{g([]),f([]),b(0),s(null),w(t,{worker:!0,delimiter:",",skipEmptyLines:!0,header:!0,complete:e=>{if(e.errors.length>0)s("Error al procesar el archivo CSV"),console.error(e.errors);else{const r=Object.keys(e.data[0]);if(r.length!==l.length){s(`El archivo CSV debe tener ${l.length} columnas. Actualmente tiene ${r.length}.`);return}if(!l.every(o=>r.includes(o))){s(`El archivo CSV debe contener las siguientes columnas: ${l.join(", ")}.`);return}s(null),b(e.data.length);const i=_(e.data);if(f(i),e.data.length>0){const o=Object.keys(e.data[0]).map(m=>({field:m,sortable:!0,resizable:!0}));g(o)}}}})},D=t=>{const e=t.target.files;if(e&&e[0]){const r=e[0],i=new FileReader;i.onload=o=>{if(!o.target){s("No se pudo leer el archivo CSV");return}const m=o.target.result;E(m)},i.onerror=()=>{s("No se pudo leer el archivo CSV")},i.readAsText(r),C(r)}else s("No se seleccionó ningún archivo")},A=async()=>{if(!j){c.warning("Por favor, selecciona un archivo antes de continuar.");return}d(!0);const t=new FormData;t.append("excelFile",j),L.subirResoluciones(t).then(({data:e})=>{if(e.success){const{mensaje:r,total_filas:i,filas_omitidas:o}=e;c.success(`${r} Total filas procesadas: ${i}. Filas omitidas: ${o}.`,{position:"top-right",autoClose:5e3,closeOnClick:!0,draggable:!0})}else c.error("El procesamiento no se completó correctamente.",{position:"top-right",autoClose:5e3})}).catch(e=>{console.error("Error al realizar la solicitud:",e),c.error(`Error al realizar la solicitud: ${e.message}`,{position:"top-right",autoClose:5e3}),d(!1)}).finally(()=>{d(!1)})};return n.useEffect(()=>{h("subir_resoluciones")?S(!1):p("/")},[h,p]),v?a.jsx(F,{}):a.jsx("div",{className:"flex flex-col justify-center items-center",children:a.jsxs("div",{children:[a.jsx("label",{className:"text-2xl font-extrabold dark:text-white",htmlFor:"file_input",children:"Subir Autos supremos en CSV"}),a.jsx("input",{accept:".csv",onChange:D,className:`block my-4 p-4 w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer\r
 bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600\r
  dark:placeholder-gray-400`,id:"file_input",type:"file"}),y&&a.jsx("p",{style:{color:"red"},children:y}),u.length>0&&a.jsxs("div",{children:[a.jsx("h3",{className:"py-4 text-sm roboto-bold dark:text-white",children:"Vista previa del contenido"}),u.length>0&&a.jsx("div",{className:"overflow-x-auto lg:max-w-[1200px] md:max-w-[500px] sm:max-w-[400px] max-w-[90dvw]",children:a.jsxs("table",{className:"table-auto border-collapse",children:[a.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:a.jsx("tr",{children:x.map(t=>a.jsx("th",{className:"p-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border-b dark:border-gray-600",children:t.field},t.field))})}),a.jsx("tbody",{children:u.map((t,e)=>a.jsx("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700",children:x.map(r=>a.jsx("td",{className:"p-3 text-sm text-gray-800 dark:text-gray-200 max-w-[200px] truncate whitespace-nowrap",title:t[r.field],children:t[r.field]},r.field))},e))})]})}),a.jsxs("h4",{className:"py-4 text-sm dark:text-white",children:[N," filas encontradas"]}),a.jsx("div",{className:"p-4 m-4 flex justify-end",children:a.jsx("div",{children:a.jsx(R,{asyncFunction:A,isLoading:k,name:"Subir"})})})]})]})})};export{P as default};
