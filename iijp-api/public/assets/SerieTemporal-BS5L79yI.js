import{f as P,r,j as e,E as O,b as R,y as M}from"./index-DfKAKSSO.js";import{E as z}from"./dark-CE_-lrH1.js";import{f as X,b as G}from"./arrayUtils-CO_8jNSz.js";import{o as K,T as U,i as V}from"./math-CatLmZRW.js";import{S as Y}from"./StatsService-CJTEx-IJ.js";import{u as p}from"./useSessionStorage-BciEVf3a.js";const $=({option:x,border:l=!0})=>{const{isDark:o}=P(),n=r.useRef(null),h=d=>{const a=n.current?.getEchartsInstance();if(!a)return;const c=d.axesInfo?.[0];if(!c)return;const s=c.value+1;a.setOption({series:{id:"pie",label:{formatter:`{b}: {@[${s}]} ({d}%)`},encode:{value:s,tooltip:s}}})},i=d=>{console.log(d)};return e.jsx("div",{className:`p-2 m-2 rounded-xl bg-white dark:bg-[#100C2A] h-[600px] ${l?"border shadow-lg border-gray-300 dark:border-gray-800":""}`,children:e.jsx(z,{option:x,theme:o?"dark":void 0,style:{height:"100%",width:"100%"},onEvents:{updateAxisPointer:h,click:i},ref:n},JSON.stringify(x))})},ee=()=>{const x=O(),l=R(),o=x.state?.params,[n,h]=r.useState(""),[i,d]=r.useState([]),[a,c]=r.useState([]),[s,b]=p("serie",[]),[u,f]=p("total-serie",0),[v,j]=r.useState([]),[g,y]=r.useState(!0),[N,k]=r.useState(null),S={legend:{},tooltip:{trigger:"axis",showContent:!1},dataset:{source:i},xAxis:{type:"category"},yAxis:{gridIndex:0},grid:{top:"55%"},series:[...v,{type:"pie",id:"pie",radius:"30%",center:["50%","25%"],emphasis:{focus:"self"},label:{formatter:"{b}: {@2012} ({d}%)"},encode:{itemName:"nombre",value:"2012",tooltip:"2012"}}]},w=()=>{c(V(a))},E=()=>{if(o.nombre==="departamento"){M.warning("No se puede realizar un an치lisis por departamento, por favor seleccione una variable diferente.");return}l("/mapa-estadistico/"+o.nombre,{state:{validatedData:o}})},A=()=>{l("/analisis-avanzado/",{state:{params:o}})};r.useEffect(()=>{o==null||!Array.isArray(o.variable)?l("/analisis-avanzado"):C()},[o]);const C=()=>{if(s.length>0){console.log("Datos ya cargados, no se vuelve a cargar");return}Y.getTimeSeries(o).then(({data:t})=>{console.log("Datos cargados desde API",t),t&&(b(t.data.length>0?t.data:[]),f(t.total))}).catch(t=>{console.error("Error fetching data:",t)})};r.useEffect(()=>{d(s.length>0?X(s,u,.1):[]),c(s.length>0?G(s):[])},[s]),r.useEffect(()=>{if(!i||Object.keys(i).length===0)return;const t=Object.keys(i).splice(1);j(t.map(()=>({type:"line",smooth:!0,seriesLayoutBy:"row",emphasis:{focus:"series"}})))},[i]),r.useEffect(()=>{if(a&&a.length>0){let t=a[0];k(t.map((m,I)=>({accessorKey:I.toString(),header:m.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase()),enableSorting:!0})))}},[a]);const{mean:D,min:q,max:B,stdDev:T,variance:F}=r.useMemo(()=>{const t=K(a);return{mean:t.mean||0,min:t.min||0,max:t.max||0,stdDev:t.stdDev||0,variance:t.variance||0}},[a]);return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-4 text-sm",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"flex flex-row flex-wrap gap-2 items-center justify-center p-4 mb-4",children:[e.jsx("button",{onClick:()=>E(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-sky-600 to-blue-700 hover:from-sky-700 hover:to-blue-800 shadow-md transition-all",children:"ir a Mapa Geogr치fico"}),e.jsx("button",{onClick:()=>A(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-pink-600 to-red-octopus-600 hover:from-pink-700 hover:to-red-octopus-800 shadow-md transition-all",children:"ir a An치lisis X-Y"})]})})}),e.jsx("div",{children:s.length>0?s.map((t,m)=>e.jsx("div",{children:e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200",children:t.name})},m)):e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No hay datos disponibles"})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200",children:"Estad칤sticas Generales"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[s.length>0&&e.jsx("div",{className:"font-bold text-xl text-blue-600 dark:text-blue-400",children:s[0].length-1}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Periodos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-xl text-green-600 dark:text-green-400",children:u.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Resoluciones"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-xl text-purple-600 dark:text-purple-400",children:(s.length-1).toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Categor칤as"})]}),e.jsxs("div",{className:"text-center",children:[a.length>0&&e.jsx("div",{className:"font-bold text-xl text-orange-600 dark:text-orange-400",children:D.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Promedio"})]}),e.jsxs("div",{className:"text-center",children:[a.length>0&&e.jsx("div",{className:"font-bold text-xl text-orange-600 dark:text-orange-400",children:T.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Desviaci칩n Est치ndar"})]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-800 dark:text-blue-300 text-sm",children:["游눠 ",e.jsx("strong",{children:"Instrucciones:"})," Haga clic en cualquier periodo de la serie de tiempo para ver su distribuci칩n detallada en el gr치fico circular.",n&&e.jsxs("span",{className:"block mt-1",children:["Mostrando datos de: ",e.jsx("strong",{children:n})]})]})}),e.jsxs("div",{className:"grid mt-4 grid-cols-1 sm:grid-cols-4 md:grid-cols-5 px-4 gap-2",children:[e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-700 rounded-lg shadow-lg border-2 dark:border-gray-700 flex flex-col gap-4",children:[e.jsx("button",{onClick:()=>y(t=>!t),className:"p-2 mt-4 rounded-lg text-white bg-red-octopus-600 hover:bg-red-octopus-800 sm:w-full",children:g?"Ver Tabla":"Ver gr치fico"}),!g&&e.jsx("button",{onClick:()=>w(),className:"p-2 rounded-lg text-white bg-red-octopus-600 hover:bg-red-octopus-800 sm:w-full",children:"Invertir tabla"})]}),e.jsx("div",{className:"sm:col-span-3 md:col-span-4",children:g?e.jsx($,{option:S}):e.jsx(U,{data:a.slice(1),columns:N})})]})]})};export{ee as default};
