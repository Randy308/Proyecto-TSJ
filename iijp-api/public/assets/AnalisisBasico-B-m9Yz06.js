import{G as ee,D as te,E as ae,b as se,r as a,u as re,C as p,j as e,L as le}from"./index-DfKAKSSO.js";import{S as oe}from"./SimpleChart-CfrclA1U.js";import{T as ne,t as ie}from"./math-CatLmZRW.js";import{S as ce,a as D}from"./Select-Cqm4wJik.js";import{A as de}from"./AsyncButton-DiTkpQVw.js";import{a as ue}from"./filterForm-BY0rdyPp.js";import{a as me}from"./arrayUtils-CO_8jNSz.js";import"./dark-CE_-lrH1.js";import"./MultiBtnDropdown-CPY46KGv.js";import"./Icons-AMBJMzXu.js";import"./index-CvxPIX6S.js";import"./index-DbfdK6-c.js";function he(f){return ee({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 3 4 7l4 4"},child:[]},{tag:"path",attr:{d:"M4 7h16"},child:[]},{tag:"path",attr:{d:"m16 21 4-4-4-4"},child:[]},{tag:"path",attr:{d:"M20 17H4"},child:[]}]})(f)}const Le=()=>{const{id:f}=te(),x=ae(),T=se(),l=x.state?.data,c=x.state?.validatedData,[n,k]=a.useState(null),[j,X]=a.useState(null),[v,ge]=a.useState(.05),[z,m]=a.useState({}),[be,B]=a.useState(null),[y,F]=a.useState(null),[I,P]=a.useState(null),[R,h]=a.useState(),[S,G]=a.useState(!0),[i,w]=a.useState([]),[N,C]=a.useState(!1),[g,O]=a.useState(0),[d,A]=a.useState([]),[Y,U]=a.useState("Nombre"),[H,L]=a.useState(!1),{data:K}=re();a.useEffect(()=>{c&&p.obtenerFiltrosEstadisticos(c).then(t=>{t.data&&F(ue(t.data,K))}).catch(t=>{console.log("Existe un error "+t)})},[c]);const E=a.useMemo(()=>y,[y]),[W,V]=a.useState(0),[u,M]=a.useState([]),[b,_]=a.useState(!1);a.useEffect(()=>{l===null||!Array.isArray(l.data)?T("/estadisticas-basicas"):(B(l.terminos),k(l.data.length>0?l.data:[]),A(l.data.length>0?l.data:[]),X(l.columna),O(l.total),C(l.multiVariable),U(l.nombre))},[l]);const $=t=>{const s=[];for(let r=0;r<t;r++)s.push({type:"bar",seriesLayoutBy:"column"});return s};a.useEffect(()=>{if(n&&n.length>0){const{nuevaLista:t,headers:s,values:r}=me(N,n,Y);w(t),m({legend:{},tooltip:{trigger:"item"},grid:{containLabel:!0},dataset:{source:[s,...r]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!0},yAxis:{},series:$(s.length-1)})}},[n]);const q=t=>{h(t),m(s=>D(s,t.toLowerCase()))},J=()=>{const t=!b;_(t),t?V(1):(M([]),V(0))},Q=()=>{L(!0);const t=u.length>0,s=t?{...c,variableY:u[0].ids,nombreY:u[0].name}:{...c};(t?p.realizarAnalisisXY(s):p.realizarAnalisis(s)).then(({data:o})=>{console.log("Datos cargados desde API",o),o&&(k(o.data.length>0?o.data:[]),A(o.data.length>0?o.data:[]),C(o.multiVariable))}).catch(o=>{console.error("Error fetching data:",o)}).finally(()=>{h("bar"),L(!1)})},Z=()=>{h("column"),m(s=>D(s,"column",!0));const t=ie(i);w(t)};return a.useEffect(()=>{if(d&&d.length>0&&g>0){let t=0;const s=d.map(r=>r.cantidad/g>=v?{nombre:r.nombre,cantidad:r.cantidad}:(t+=r.cantidad,null)).filter(r=>r!==null);t>0&&s.push({nombre:"Otros",cantidad:t})}},[d,g,v]),a.useEffect(()=>{if(i&&i.length>0){let t=Object.keys(i[0]);P(t.map(s=>({accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase()),enableSorting:!0})))}},[i]),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-1 p-2 m-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"p-4 border border-gray-300 dark:border-gray-950 bg-white dark:bg-gray-600 rounded-lg shadow-lg",children:[j&&e.jsxs("p",{className:"text-black dark:text-white pb-4",children:["Variable observada:",e.jsxs("span",{className:"italic font-bold capitalize",children:[" ",j]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"charts",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Tipo de gráficos"}),e.jsxs("select",{id:"charts",value:R,onChange:t=>q(t.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",children:[e.jsx("option",{disabled:!0,defaultValue:!0,children:"Elige un tipo de gráfico"}),e.jsx("option",{value:"bar",children:"Barras"}),e.jsx("option",{value:"column",children:"Columnas"}),e.jsx("option",{value:"area",children:"Área"}),N?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"stacked-bar",children:"Barras Apiladas"}),e.jsx("option",{value:"stacked-column",children:"Columnas Apiladas"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"pie",children:"Circular"}),e.jsx("option",{value:"donut",children:"Dona"})]})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"inline-flex items-center flex-wrap-reverse cursor-pointer m-4",children:[e.jsx("input",{type:"checkbox",checked:b,onChange:()=>J(),className:"sr-only peer"}),e.jsx("div",{className:"relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"}),e.jsx("span",{className:"ms-3 text-xs font-medium text-gray-900 dark:text-gray-300",children:"Cruce por una variable"})]})}),e.jsxs("div",{className:` ${b?"":"hidden"}  `,children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Variables"}),E&&e.jsx(ce,{memoizedParams:E,limite:W,listaX:u,setListaX:M}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2 pb-2",children:[e.jsxs("button",{type:"button",onClick:()=>Z(),className:"inline-flex items-center text-white bg-red-octopus-700 hover:bg-red-octopus-600 dark:bg-blue-700 dark:hover:bg-blue-600  font-medium rounded-lg text-sm px-5 py-3 text-center",children:[e.jsx(he,{className:"fill-current w-4 h-4 mr-2"}),e.jsx("span",{className:"text-xs",children:"Intercambio X-Y"})]}),e.jsx(de,{name:"Analizar",asyncFunction:Q,isLoading:H,full:!1})]})]})]}),n&&n.length>0?e.jsx("div",{className:"max-w-sm mx-auto mt-4",children:e.jsx("button",{onClick:()=>G(t=>!t),type:"button",className:"w-full mt-2 text-white bg-red-octopus-600 dark:bg-blue-600 hover:bg-red-octopus-800 hover:dark:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:S?"Mostrar Tabla ":"Mostrar Grafico"})}):""]}),n&&n.length>0?e.jsx("div",{className:"lg:col-span-4 md:col-span-3",children:S?e.jsx(oe,{option:z}):e.jsx(ne,{data:i,columns:I})}):e.jsx("div",{children:e.jsx(le,{})})]})};export{Le as default};
