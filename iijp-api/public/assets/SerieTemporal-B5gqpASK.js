import{f as P,r as a,j as e,D as O,b as R,y as M}from"./index-BO822pXt.js";import{E as z}from"./dark-BqHvJBHV.js";import{f as X,a as G,o as K,T as U,i as V}from"./arrayUtils-BvjMR7rG.js";import{S as Y}from"./StatsService-BFohO0Hj.js";import{u as b}from"./useSessionStorage-4LI4q90B.js";const $=({option:x,border:n=!0})=>{const{isDark:r}=P(),d=a.useRef(null),u=c=>{const s=d.current?.getEchartsInstance();if(!s)return;const g=c.axesInfo?.[0];if(!g)return;const l=g.value+1;s.setOption({series:{id:"pie",label:{formatter:`{b}: {@[${l}]} ({d}%)`},encode:{value:l,tooltip:l}}})},i=c=>{console.log(c)};return e.jsx("div",{className:`p-2 m-2 rounded-xl bg-white dark:bg-[#100C2A] h-[600px] ${n?"border shadow-lg border-gray-300 dark:border-gray-800":""}`,children:e.jsx(z,{option:x,theme:r?"dark":void 0,style:{height:"100%",width:"100%"},onEvents:{updateAxisPointer:u,click:i},ref:d},JSON.stringify(x))})},Z=()=>{const x=O(),n=R(),r=x.state?.params,[d,u]=a.useState(""),[i,c]=a.useState([]),[s,g]=b("serie",[]),[l,f]=b("total-serie",0),[v,j]=a.useState([]),[m,y]=a.useState(!0),[o,p]=a.useState([]),[N,k]=a.useState(null),S={legend:{},tooltip:{trigger:"axis",showContent:!1},dataset:{source:i},xAxis:{type:"category"},yAxis:{gridIndex:0},grid:{top:"55%"},series:[...v,{type:"pie",id:"pie",radius:"30%",center:["50%","25%"],emphasis:{focus:"self"},label:{formatter:"{b}: {@2012} ({d}%)"},encode:{itemName:"nombre",value:"2012",tooltip:"2012"}}]},w=()=>{p(V(o))},A=()=>{if(r.nombre==="departamento"){M.warning("No se puede realizar un an치lisis por departamento, por favor seleccione una variable diferente.");return}n("/mapa-estadistico/"+r.nombre,{state:{validatedData:r}})},D=()=>{n("/analisis-avanzado/",{state:{params:r}})};a.useEffect(()=>{r==null||!Array.isArray(r.variable)?n("/analisis-avanzado"):E()},[r]);const E=()=>{if(s.length>0){console.log("Datos ya cargados, no se vuelve a cargar");return}Y.getTimeSeries(r).then(({data:t})=>{console.log("Datos cargados desde API",t),t&&(g(t.data.length>0?t.data:[]),f(t.total))}).catch(t=>{console.error("Error fetching data:",t)})};a.useEffect(()=>{c(s.length>0?X(s,l,.1):[]),p(s.length>0?G(s):[])},[s]),a.useEffect(()=>{if(!i||Object.keys(i).length===0)return;const t=Object.keys(i).splice(1);j(t.map(()=>({type:"line",smooth:!0,seriesLayoutBy:"row",emphasis:{focus:"series"}})))},[i]),a.useEffect(()=>{if(o&&o.length>0){let t=o[0];k(t.map((h,I)=>({accessorKey:I.toString(),header:h.replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase()),enableSorting:!0})))}},[o]);const{mean:C,min:q,max:B,stdDev:T,variance:F}=a.useMemo(()=>{const t=K(o);return{mean:t.mean||0,min:t.min||0,max:t.max||0,stdDev:t.stdDev||0,variance:t.variance||0}},[o]);return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-4 text-sm",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"flex flex-row flex-wrap gap-2 items-center justify-center p-4 mb-4",children:[e.jsx("button",{onClick:()=>A(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-sky-600 to-blue-700 hover:from-sky-700 hover:to-blue-800 shadow-md transition-all",children:"ir a Mapa Geogr치fico"}),e.jsx("button",{onClick:()=>D(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-pink-600 to-red-octopus-600 hover:from-pink-700 hover:to-red-octopus-800 shadow-md transition-all",children:"ir a An치lisis X-Y"})]})})}),e.jsx("div",{children:s.length>0?s.map((t,h)=>e.jsx("div",{children:e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200",children:t.name})},h)):e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No hay datos disponibles"})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200",children:"Estad칤sticas Generales"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[s.length>0&&e.jsx("div",{className:"font-bold text-xl text-blue-600 dark:text-blue-400",children:s[0].length-1}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Periodos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-xl text-green-600 dark:text-green-400",children:l.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Resoluciones"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-xl text-purple-600 dark:text-purple-400",children:(s.length-1).toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Categor칤as"})]}),e.jsxs("div",{className:"text-center",children:[o.length>0&&e.jsx("div",{className:"font-bold text-xl text-orange-600 dark:text-orange-400",children:C.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Promedio"})]}),e.jsxs("div",{className:"text-center",children:[o.length>0&&e.jsx("div",{className:"font-bold text-xl text-orange-600 dark:text-orange-400",children:T.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Desviaci칩n Est치ndar"})]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-800 dark:text-blue-300 text-sm",children:["游눠 ",e.jsx("strong",{children:"Instrucciones:"})," Haga clic en cualquier periodo de la serie de tiempo para ver su distribuci칩n detallada en el gr치fico circular.",d&&e.jsxs("span",{className:"block mt-1",children:["Mostrando datos de: ",e.jsx("strong",{children:d})]})]})}),e.jsxs("div",{className:"grid mt-4 grid-cols-1 sm:grid-cols-4 md:grid-cols-5 px-4 gap-2",children:[e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-700 rounded-lg shadow-lg border-2 dark:border-gray-700 flex flex-col gap-4",children:[e.jsx("button",{onClick:()=>y(t=>!t),className:"p-2 mt-4 rounded-lg text-white bg-red-octopus-600 hover:bg-red-octopus-800 sm:w-full",children:m?"Ver Tabla":"Ver gr치fico"}),!m&&e.jsx("button",{onClick:()=>w(),className:"p-2 rounded-lg text-white bg-red-octopus-600 hover:bg-red-octopus-800 sm:w-full",children:"Invertir tabla"})]}),e.jsx("div",{className:"sm:col-span-3 md:col-span-4",children:m?e.jsx($,{option:S}):e.jsx(U,{data:o.slice(1),columns:N})})]})]})};export{Z as default};
