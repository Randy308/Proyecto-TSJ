import{G,x as O,c as H,r as t,a as K,R as x,j as e,L as U}from"./index-CS51DAse.js";import{a as C,T as W,i as _}from"./arrayUtils-_cr7Npey.js";import{S as $,O as q}from"./OptionChart-Dv3jTv_h.js";import{A as J}from"./AsyncButton-O7CY9z2J.js";import{a as Q}from"./filterForm-qRQJ7N12.js";import"./MultiBtnDropdown-oYVBAFdf.js";import"./Icons-Beyyzlav.js";import"./index-BBE9PvKj.js";import"./index-Bjhrrt2E.js";import"./dark-Bdao2Wg9.js";function Z(u){return G({attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M8 3 4 7l4 4"},child:[]},{tag:"path",attr:{d:"M4 7h16"},child:[]},{tag:"path",attr:{d:"m16 21 4-4-4-4"},child:[]},{tag:"path",attr:{d:"M20 17H4"},child:[]}]})(u)}const de=()=>{const u=O(),S=H(),l=u.state?.data,i=u.state?.validatedData,[n,b]=t.useState([]),[c,A]=t.useState(null),[f,L]=t.useState({}),[X,M]=t.useState([]),[h,g]=t.useState("bar"),[v,V]=t.useState(!0),[m,j]=t.useState(!1),[D,k]=t.useState(!1),{data:E}=K(),[o,p]=t.useState([]),y=t.useMemo(()=>f,[f]),B=t.useMemo(()=>1,[]),[d,T]=t.useState([]),[w,Y]=t.useState(!1),z=()=>{Y(a=>!a)},F=async()=>{k(!0);const a=d.length>0,r=a?{...i,variableY:d[0].ids,nombreY:d[0].name}:{...i};(a?x.realizarAnalisisXY(r):x.realizarAnalisis(r)).then(({data:s})=>{console.log("Datos cargados desde API",s),s&&(b(s.data.length>0?s.data:[]),j(s.multiVariable),p(s.data.length>0?C(s.data):[]),console.log("Datos de tabla:",s.data))}).catch(s=>{console.error("Error fetching data:",s)}).finally(()=>{g("bar"),k(!1)})},I=()=>{g("column"),p(_(o))};t.useEffect(()=>{if(o&&o.length>0){const a=o[0];M(a.map((r,N)=>({accessorKey:N.toString(),header:String(r).replace(/_/g," ").replace(/\b\w/g,s=>s.toUpperCase())})))}},[o]),t.useEffect(()=>{if(!l||!Array.isArray(l.data))S("/estadisticas-basicas");else{const a=l.data.length>0?l.data:[];b(a),p(C(a)),A(l.columna),j(l.multiVariable)}},[l]),t.useEffect(()=>{i&&x.obtenerFiltrosEstadisticos(i).then(a=>{a.data&&L(Q(a.data,E||{}))}).catch(a=>{console.log("Existe un error "+a)})},[i]);const P=t.useCallback(a=>{if(c)if(m){const r={nameX:d[0].name,valueX:a.seriesName,nameY:c,valueY:a.name};console.log(r)}else{const r={nameX:c,valueX:a.name!="Cantidad"?a.name:a.seriesName};console.log(r)}},[m]),R=a=>{const r=a.target.value;h!=r&&g(r)};return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-1 p-2 m-2 lg:grid-cols-5",children:[e.jsxs("div",{className:"p-4 border border-gray-300 dark:border-gray-950 bg-white dark:bg-gray-600 rounded-lg shadow-lg",children:[c&&e.jsxs("p",{className:"text-black dark:text-white pb-4",children:["Variable observada:",e.jsxs("span",{className:"italic font-bold capitalize",children:[" ",c]})]}),e.jsxs("div",{children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"charts",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Tipo de gráficos"}),e.jsxs("select",{id:"charts",value:h,onChange:a=>R(a),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",children:[e.jsx("option",{disabled:!0,defaultValue:"",children:"Elige un tipo de gráfico"}),m?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"bar",children:"Barras Agrupadas"}),e.jsx("option",{value:"stackedBar",children:"Barras Apiladas"}),e.jsx("option",{value:"stackedColumn",children:"Columnas Apiladas"}),e.jsx("option",{value:"column",children:"Columnas Agrupadas"}),e.jsx("option",{value:"multiLine",children:"Lineas Multiples"}),e.jsx("option",{value:"stackedArea",children:"Área Apilada"}),e.jsx("option",{value:"polar",children:"Polar"}),e.jsx("option",{value:"radar",children:"Radar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"bar",children:"Barras"}),e.jsx("option",{value:"column",children:"Columnas"}),e.jsx("option",{value:"area",children:"Área"}),e.jsx("option",{value:"scatter",children:"Dispersión"}),e.jsx("option",{value:"line",children:"Lineas"}),e.jsx("option",{value:"pie",children:"Circular"}),e.jsx("option",{value:"donut",children:"Dona"})]})]})]}),e.jsx("div",{children:e.jsxs("label",{className:"inline-flex items-center flex-wrap-reverse cursor-pointer m-4",children:[e.jsx("input",{type:"checkbox",checked:w,onChange:()=>z(),className:"sr-only peer"}),e.jsx("div",{className:"relative w-9 h-5 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600 dark:peer-checked:bg-blue-600"}),e.jsx("span",{className:"ms-3 text-xs font-medium text-gray-900 dark:text-gray-300",children:"Cruce por una variable"})]})}),e.jsxs("div",{className:` ${w?"":"hidden"}  `,children:[e.jsx("label",{className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Variables"}),y&&e.jsx($,{memoizedParams:y,limite:B,listaX:d,setListaX:T}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-2 pb-2",children:[e.jsxs("button",{type:"button",onClick:()=>I(),className:"inline-flex items-center text-white bg-red-octopus-700 hover:bg-red-octopus-600 dark:bg-blue-700 dark:hover:bg-blue-600  font-medium rounded-lg text-sm px-5 py-3 text-center",children:[e.jsx(Z,{className:"fill-current w-4 h-4 mr-2"}),e.jsx("span",{className:"text-xs",children:"Intercambio X-Y"})]}),e.jsx(J,{name:"Analizar",asyncFunction:F,isLoading:D,full:!1})]})]})]}),n&&n.length>0?e.jsx("div",{className:"max-w-sm mx-auto mt-4",children:e.jsx("button",{onClick:()=>V(a=>!a),type:"button",className:"w-full mt-2 text-white bg-red-octopus-600 dark:bg-blue-600 hover:bg-red-octopus-800 hover:dark:bg-blue-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:v?"Mostrar Tabla ":"Mostrar Grafico"})}):""]}),n&&n.length>0?e.jsx("div",{className:"lg:col-span-4 md:col-span-3",children:v?e.jsx(q,{dataset:n,chartType:h,isMultiVariable:m,handleClick:P}):e.jsx(W,{data:o.slice(1),columns:X})}):e.jsx("div",{children:e.jsx(U,{})})]})};export{de as default};
