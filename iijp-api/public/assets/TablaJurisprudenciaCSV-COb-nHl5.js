import{u as V,c as A,r as n,j as r,L,y as i,U as F}from"./index-CS51DAse.js";import{S as R}from"./react-papaparse.es-BLGhBF7Q.js";import{A as M}from"./AsyncButton-O7CY9z2J.js";import"./Icons-Beyyzlav.js";import"./index-BBE9PvKj.js";import"./index-Bjhrrt2E.js";const q=()=>{const{can:m}=V(),p=A(),[v,S]=n.useState(!0),c=["tipo_jurisprudencia","restrictor","ratio","descriptor","id_resolucion","descriptor_id","restrictor_id","root_id"],[k,h]=n.useState(!1),{readString:w}=R(),[g,x]=n.useState([]),[d,f]=n.useState([]),[N,b]=n.useState(0),[y,o]=n.useState(null),[j,E]=n.useState(null),C=s=>{const e=Math.ceil(20);return[...s].sort(()=>.5-Math.random()).slice(0,e)},D=s=>{x([]),f([]),b(0),o(null),w(s,{worker:!0,delimiter:",",skipEmptyLines:!0,header:!0,complete:e=>{if(e.errors.length>0)o("Error al procesar el archivo CSV"),console.error(e.errors);else{const t=Object.keys(e.data[0]);if(t.length!==c.length){o(`El archivo CSV debe tener ${c.length} columnas. Actualmente tiene ${t.length}.`);return}if(!c.every(l=>t.includes(l))){o(`El archivo CSV debe contener las siguientes columnas: ${c.join(", ")}.`);return}o(null),b(e.data.length);const a=C(e.data);if(f(a),e.data.length>0){const l=Object.keys(e.data[0]).map(u=>({field:u,sortable:!0,resizable:!0}));x(l)}}}})},_=s=>{const e=s.target.files;if(e&&e[0]){const t=e[0],a=new FileReader;a.onload=l=>{if(!l.target){o("No se pudo leer el archivo CSV");return}const u=l.target.result;D(u)},a.onerror=()=>{o("No se pudo leer el archivo CSV")},a.readAsText(t),E(t)}else o("No se seleccionó ningún archivo")},$=async()=>{if(!j){i.warning("Por favor, selecciona un archivo antes de continuar.");return}h(!0);const s=new FormData;s.append("excelFile",j),F.subirJurisprudencia(s).then(({data:e})=>{if(e.success){const t=e.mensaje||"Datos cargados exitosamente.",a=`Total de registros procesados: ${e.total_records}, Registros omitidos: ${e.skipped_records}`;i.success(`${t} ${a}`),console.log("Resultado:",e)}else i.warning(e.mensaje||"El servidor no pudo completar la operación.")}).catch(e=>{if(console.error("Error al realizar la solicitud:",e),e.response){const{status:t,data:a}=e.response;console.error(`Error ${t}:`,a),a.error?i.error(a.error):i.error("Ocurrió un error en el servidor.")}else e.request?i.error("No se pudo contactar al servidor. Por favor, inténtalo más tarde."):i.error(`Error inesperado: ${e.message}`)}).finally(()=>{h(!1)})};return n.useEffect(()=>{m("subir_jurisprudencia")?S(!1):p("/")},[m,p]),v?r.jsx(L,{}):r.jsx("div",{className:"flex flex-col justify-center items-center",children:r.jsxs("div",{children:[r.jsx("label",{className:"text-2xl font-extrabold dark:text-white",htmlFor:"file_input",children:"Subir jurisprudencia en CSV"}),r.jsx("input",{accept:".csv",onChange:_,className:`block my-4 p-4 w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer\r
 bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600\r
  dark:placeholder-gray-400`,id:"file_input",type:"file"}),y&&r.jsx("p",{style:{color:"red"},children:y}),d.length>0&&r.jsxs("div",{children:[r.jsx("h3",{className:"py-4 text-sm roboto-bold dark:text-white",children:"Vista previa del contenido"}),r.jsxs("h4",{className:"py-4 text-sm dark:text-white",children:[N," filas encontradas"]}),d.length>0&&r.jsx("div",{className:"overflow-x-auto lg:max-w-[1200px] md:max-w-[500px] sm:max-w-[400px] max-w-[90dvw]",children:r.jsxs("table",{className:"table-auto border-collapse",children:[r.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:r.jsx("tr",{children:g.map(s=>r.jsx("th",{className:"p-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border-b dark:border-gray-600",children:s.field},s.field))})}),r.jsx("tbody",{children:d.map((s,e)=>r.jsx("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700",children:g.map(t=>r.jsx("td",{className:"p-3 text-sm text-gray-800 dark:text-gray-200 max-w-[200px] truncate whitespace-nowrap",title:s[t.field],children:s[t.field]},t.field))},e))})]})}),r.jsx("div",{className:"p-4 m-4 flex justify-end",children:r.jsx("div",{children:r.jsx(M,{asyncFunction:$,isLoading:k,name:"Subir"})})})]})]})})};export{q as default};
