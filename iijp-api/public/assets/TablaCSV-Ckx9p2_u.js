import{A as D,b as V,r as s,f as $,j as a,y as c,U as F}from"./index-DfKAKSSO.js";import{S as T}from"./react-papaparse.es-CGzJgxxQ.js";import{A as z}from"./AsyncButton-DiTkpQVw.js";import"./TokenService-DV-O6ZEg.js";import"./Icons-AMBJMzXu.js";import"./index-CvxPIX6S.js";import"./index-DbfdK6-c.js";const q=()=>{const{can:u}=D(),h=V(),[L,j]=s.useState(!0),l=["id","nro_resolucion","nro_expediente","fecha_emision","fecha_publicacion","tipo_resolucion","departamento","id_sala","sala","magistrado","forma_resolucion","proceso","precedente","demandante","demandado","id_tema","maxima","sintesis","contenido"],[v,d]=s.useState(!1),{readString:S}=T(),[p,x]=s.useState([]),[m,g]=s.useState([]),[k,f]=s.useState([]),[b,o]=s.useState(null),[y,w]=s.useState(null);$();const N=(r,e)=>{const t=Math.ceil(20);return[...r].sort(()=>.5-Math.random()).slice(0,t)},C=r=>{x([]),g([]),f(0),o(null),S(r,{worker:!0,delimiter:",",skipEmptyLines:!0,header:!0,complete:e=>{if(e.errors.length>0)o("Error al procesar el archivo CSV"),console.error(e.errors);else{const t=Object.keys(e.data[0]);if(t.length!==l.length){o(`El archivo CSV debe tener ${l.length} columnas. Actualmente tiene ${t.length}.`);return}if(!l.every(n=>t.includes(n))){o(`El archivo CSV debe contener las siguientes columnas: ${l.join(", ")}.`);return}o(null),f(e.data.length);const i=N(e.data);if(g(i),e.data.length>0){const n=Object.keys(e.data[0]).map(A=>({field:A,sortable:!0,resizable:!0}));x(n)}}}})},_=r=>{const e=r.target.files[0];if(e){const t=new FileReader;t.onload=i=>{const n=i.target.result;C(n)},t.onerror=()=>{o("No se pudo leer el archivo CSV")},t.readAsText(e),w(e)}else o("No se seleccionó ningún archivo")},E=async()=>{if(!y){c.warning("Por favor, selecciona un archivo antes de continuar.");return}d(!0);const r=new FormData;r.append("excelFile",y),F.subirResoluciones(r).then(({data:e})=>{if(e.success){const{mensaje:t,total_filas:i,filas_omitidas:n}=e;c.success(`${t} Total filas procesadas: ${i}. Filas omitidas: ${n}.`,{position:"top-right",autoClose:5e3,closeOnClick:!0,draggable:!0})}else c.error("El procesamiento no se completó correctamente.",{position:"top-right",autoClose:5e3})}).catch(e=>{console.error("Error al realizar la solicitud:",e),c.error(`Error al realizar la solicitud: ${e.message}`,{position:"top-right",autoClose:5e3}),d(!1)}).finally(()=>{d(!1)})};return s.useEffect(()=>{u("subir_resoluciones")?j(!1):h("/")},[u,h]),a.jsx("div",{className:"flex flex-col justify-center items-center",children:a.jsxs("div",{children:[a.jsx("label",{className:"text-2xl font-extrabold dark:text-white",htmlFor:"file_input",children:"Subir Autos supremos en CSV"}),a.jsx("input",{accept:".csv",onChange:_,className:`block my-4 p-4 w-full text-sm text-gray-900 border border-gray-300 rounded-lg cursor-pointer\r
 bg-gray-50 dark:text-gray-400 focus:outline-none dark:bg-gray-700 dark:border-gray-600\r
  dark:placeholder-gray-400`,id:"file_input",type:"file"}),b&&a.jsx("p",{style:{color:"red"},children:b}),m.length>0&&a.jsxs("div",{children:[a.jsx("h3",{className:"py-4 text-sm roboto-bold dark:text-white",children:"Vista previa del contenido"}),m.length>0&&a.jsx("div",{className:"overflow-x-auto lg:max-w-[1200px] md:max-w-[500px] sm:max-w-[400px] max-w-[90dvw]",children:a.jsxs("table",{className:"table-auto border-collapse",children:[a.jsx("thead",{className:"bg-gray-100 dark:bg-gray-800",children:a.jsx("tr",{children:p.map(r=>a.jsx("th",{className:"p-3 text-left text-sm font-semibold text-gray-700 dark:text-gray-300 border-b dark:border-gray-600",children:r.field},r.field))})}),a.jsx("tbody",{children:m.map((r,e)=>a.jsx("tr",{className:"border-b dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700",children:p.map(t=>a.jsx("td",{className:"p-3 text-sm text-gray-800 dark:text-gray-200 max-w-[200px] truncate whitespace-nowrap",title:r[t.field],children:r[t.field]},t.field))},e))})]})}),a.jsxs("h4",{className:"py-4 text-sm dark:text-white",children:[k," filas encontradas"]}),a.jsx("div",{className:"p-4 m-4 flex justify-end",children:a.jsx("div",{children:a.jsx(z,{asyncFunction:E,isLoading:v,name:"Subir"})})})]})]})})};export{q as default};
