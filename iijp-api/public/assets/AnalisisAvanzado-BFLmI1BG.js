import{r,j as e,y as F,b as ae,u as te,D as se,L as re}from"./index-DjMZi7pv.js";import{A as oe}from"./AsyncButton-G5RuD1gO.js";import{S as E}from"./StatsService-DhReP_Hk.js";import{a as z,T as ne,i as le}from"./arrayUtils-BHBeUCXy.js";import{S as ie}from"./SimpleChart-C42ByWZ5.js";import{S as ce,a as B}from"./Select-CZ0Lssmf.js";import{u as G}from"./Icons-B-YI_6c9.js";import{u as q}from"./useSessionStorage-MUgBCmR9.js";import"./dark-kYNKmxVb.js";import"./MultiBtnDropdown-vJG28Rov.js";import"./filterForm-BY0rdyPp.js";import"./index-gT7YffVW.js";import"./index-Ucs30RQg.js";const de=({name:n,tabla:D,listaX:t,setListaX:y,contenido:C,agregarTermino:k,size:l=6})=>{const[h,A]=r.useState(2),{removeAllIcon:p,checkAllIcon:g}=G(),j=i=>{const u=i.target.name;y(m=>{const c=m.find(N=>N.name===n);if(c){if(c.ids.length>=l&&!c.ids.includes(u))return F.warning(`No se pueden agregar m치s de ${l} variables. Quite alguna antes de agregar.`),m;const N=c.ids.includes(u)?c.ids.filter(b=>b!==u):[...c.ids,u];return N.length===0?m.filter(b=>b.name!==n):m.map(b=>b.name===n?{...b,ids:N}:b)}else return m.length<h?[...m,{name:n,tabla:D,ids:[u]}]:(F.error(`No se puede agregar m치s de ${h} variables. Por favor, elimine alguna.`),m)})},I=()=>{y(i=>i.filter(u=>u.name!==n))},v=()=>{y(i=>{const u=i.find(c=>c.name===n),m={name:n,ids:C.slice(0,l).map(c=>c.nombre)};return u?i.map(c=>c.name===n?m:c):i.length<h?[...i,m]:(F.warning(`No se pueden agregar m치s de ${h} variables.`),i)})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-1 mb-4 px-2 sm:text-xs max-h-[600px] overflow-y-scroll",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 sm:text-xs",children:[e.jsxs("a",{onClick:()=>v(),className:"dark:bg-gray-800 dark:border-gray-700 inline-flex items-center justify-between border hover:cursor-pointer border-gray-200 p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700",children:[g,e.jsx("span",{className:"ms-2 text-xs",children:l===9?"Seleccionar todos":"Seleccionar varios"})]}),e.jsxs("a",{onClick:()=>I(),className:"dark:bg-gray-800 dark:border-gray-700 inline-flex items-center border hover:cursor-pointer border-gray-200 p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group",children:[p,e.jsx("span",{className:"ms-2 text-xs",children:"Quitar Selecci칩n"})]})]}),e.jsxs("ul",{className:"flex-1 grid grid-cols-1 py-4",children:[C.map(i=>e.jsxs("li",{className:"p-1 flex items-center",children:[e.jsx("input",{type:"checkbox",id:i.nombre+n,name:i.nombre,value:i.nombre,className:"peer hidden",checked:t.some(u=>u.name===n&&u.ids.includes(i.nombre)),onChange:j}),e.jsx("label",{htmlFor:i.nombre+n,className:"w-full p-2 cursor-pointer rounded-sm dark:hover:text-gray-300 dark:border-gray-700 peer-checked:bg-gray-50  peer-checked:text-red-octopus-500 peer-checked:border-l-4 peer-checked:border-red-octopus-500 hover:text-gray-600 dark:peer-checked:text-gray-300 text-sm peer-checked:dark:bg-gray-900 hover:bg-gray-50 dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-700 capitalize",children:i.nombre})]},i.nombre)),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>k(),className:"w-full text-white end-2.5 bottom-2.5 bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 text-xs",children:"Cargar mas"})})]})]})})},ue=[{tabla:"resolutions",columna:"precedente",nombre:"Precedente",busqueda:!0},{tabla:"resolutions",columna:"proceso",nombre:"Proceso",busqueda:!0},{tabla:"resolutions",columna:"maxima",nombre:"Maxima",busqueda:!0},{tabla:"resolutions",columna:"sintesis",nombre:"S칤ntesis",busqueda:!0},{tabla:"jurisprudencias",columna:"restrictor",nombre:"Restrictor",busqueda:!0},{tabla:"jurisprudencias",columna:"ratio",nombre:"Ratio",busqueda:!0}],me=({listaX:n,setListaX:D})=>{const{arrowUpIcon:t,arrowDownIcon:y,trashIcon:C,spinIcon:k}=G(),[l,h]=r.useState(null),[A,p]=r.useState([]),[g,j]=r.useState(null),[I,v]=r.useState({}),[i,u]=r.useState(!1),[m,c]=r.useState([]),N=()=>{let s=m[l.columna]?m[l.columna].page:1;s=s+1;const f=m[l.columna]?m[l.columna].last:1;if(s>=f){alert("No hay mas terminos para agregar");return}E.obtenerTerminos({nombre:l.columna,page:s}).then(({data:d})=>{const S=[...A,...d.data];p(S),v(M=>({...M,[l.columna]:S})),c(M=>({...M,[l.columna]:{page:d.current_page,last:d.last_page}}))}).catch(d=>{console.error("Error fetching data",d)}).finally(()=>{u(!1),j(null)})},b=s=>{console.log(n);const f=n.filter(d=>d.name!==s);D(f)},_=(s,f=1)=>{if(l&&s.columna===l.columna){p([]),h(null);return}I[s.columna]?(p(I[s.columna]),h(s)):(u(!0),j(s.columna),E.obtenerTerminos({nombre:s.columna,page:f}).then(({data:d})=>{p(d.data),v(S=>({...S,[s.columna]:d.data})),c(S=>({...S,[s.columna]:{page:d.current_page,last:d.last_page}})),h(s)}).catch(d=>{console.error("Error fetching data",d)}).finally(()=>{u(!1),j(null)}))};return e.jsx("div",{children:ue.map((s,f)=>e.jsxs("div",{children:[e.jsxs("div",{className:"p-2 rounded-lg border flex items-center justify-between text-sm  me-2 mb-2 ",children:[e.jsx("div",{className:"text-xs sm:text-sm text-black dark:text-gray-200",children:s.nombre}),e.jsxs("div",{className:"flex gap-4",children:[n&&n.length>0&&n.some(d=>d.name===s.columna)&&e.jsx("button",{className:"p-2 bg-red-500 rounded-lg hover:bg-red-600 cursor-pointer ",onClick:()=>b(s.columna),children:C}),e.jsx("button",{className:"p-2 rounded-lg cursor-pointer border border-gray-400 dark:border-gray-600",onClick:()=>_(s),children:l&&l.columna===s.columna?t:i&&g===s.columna?k:y})]})]}),l&&l.columna===s.columna&&A.length>0&&e.jsx(de,{listaX:n,setListaX:D,contenido:A,tabla:s.tabla,name:s.columna,agregarTermino:N})]},f))})},Ie=()=>{const[n,D]=r.useState(2),[t,y]=r.useState([]),[C,k]=r.useState(!1),l=ae(),{data:h}=te(),[A,p]=r.useState(),[g,j]=q("analisis_xy",[]),[I,v]=r.useState({}),[i,u]=r.useState("nombre"),[m,c]=r.useState(null),[N,b]=q("serie",[]),[_,s]=q("mapa",[]),[f,d]=r.useState(!0),[S,M]=r.useState([]),[V,X]=r.useState(!1),[ge,R]=r.useState(0),[w,P]=r.useState([]),L=se().state?.params,Y=r.useMemo(()=>{const{periodo:a,...o}=h||{};return o},[h]),$=a=>{const o=[];for(let T=0;T<a;T++)o.push({type:"bar",seriesLayoutBy:"column"});return o};r.useEffect(()=>{g&&g.length>0&&v({legend:{},tooltip:{trigger:"item"},grid:{containLabel:!0},dataset:{source:g},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!0},yAxis:{},series:$(g[0].length-1)})},[g]);const Q=a=>{p(a),v(o=>B(o,a.toLowerCase()))},U=()=>{p("column"),v(a=>B(a,"column",!0)),P(le(w))};r.useEffect(()=>{if(w&&w.length>0){let a=w[0];c(a.map((o,T)=>({accessorKey:T.toString(),header:o.replace(/_/g," ").replace(/\b\w/g,x=>x.toUpperCase()),enableSorting:!0})))}console.log(w)},[w]);const J=()=>{if(t.length===0)return;k(!0);const a=t.length>1,o=a?{nombre:t[0].name,variable:t[0].ids,nombreY:t[1].name,variableY:t[1].ids}:{nombre:t[0].name,variable:t[0].ids};(a?E.getStatsXY(o):E.getStatsX(o)).then(({data:x})=>{console.log("Datos cargados desde API",x),x&&(j(x.data.length>0?x.data:[]),X(x.multiVariable),R(x.total),P(x.data.length>0?z(x.data):[]),s([]),b([]))}).catch(x=>{console.error("Error fetching data:",x)}).finally(()=>{p("bar"),k(!1)})},K=()=>{if(t.length===0)return;const a={nombre:t[0].name,variable:t[0].ids};l(`/serie-temporal/${a.nombre}`,{state:{params:a}})},O=r.useMemo(()=>e.jsx(ce,{memoizedParams:Y,limite:n,listaX:t,setListaX:y}),[Y,n,t]),H=r.useMemo(()=>e.jsx(me,{setListaX:y,listaX:t}),[t]),W=r.useMemo(()=>J,[t]),Z=()=>{if(t.length===0)return;const a={nombre:t[0].name,variable:t[0].ids};if(a.nombre==="departamento"){F.warning("No se puede realizar un an치lisis por departamento, por favor seleccione una variable diferente.");return}l("/mapa-estadistico/"+a.nombre,{state:{validatedData:a}})};r.useEffect(()=>{if(L&&Array.isArray(L.variable)){const a={name:L.nombre,ids:L.variable};if(y([a]),g&&g.length>0)return;k(!0),E.getStatsX(L).then(({data:o})=>{console.log("Datos cargados desde API",o),o&&(j(o.data.length>0?o.data:[]),X(o.multiVariable),P(o.data.length>0?z(o.data):[]))}).catch(o=>{console.error("Error fetching data:",o)}).finally(()=>{k(!1)})}else j([]),s([]),b([])},[L]);const ee=r.useCallback(a=>{if(V&&a.seriesName!=="Cantidad"&&a.name!=="Cantidad"){const o={nameX:t[0].name,valueX:a.name,nameY:t[1].name,valueY:a.seriesName};console.log("Clicked on series:",o)}else if(a.seriesName==="Cantidad"||a.name==="Cantidad"){const o={nameX:t[0].name,valueX:a.name!="Cantidad"?a.name:a.seriesName};console.log("Clicked on series:",o)}},[V]);return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-4 text-sm",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"flex flex-row flex-wrap gap-2 items-center justify-center p-4 mb-4",children:[e.jsx("button",{onClick:()=>Z(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-sky-600 to-blue-700 hover:from-sky-700 hover:to-blue-800 shadow-md transition-all",children:"ir a Mapa Geogr치fico"}),e.jsx("button",{onClick:()=>K(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-md transition-all",children:"ir a Serie de Tiempo"})]})})}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-800 dark:text-blue-300 text-sm leading-relaxed",children:["游눠 ",e.jsx("strong",{children:"Instrucciones:"})," Seleccione una o dos"," ",e.jsx("strong",{children:"categor칤as"})," para generar el an치lisis estad칤stico. Puede agregar hasta ",e.jsx("strong",{children:"6 variables"})," por cada dimensi칩n del an치lisis (X o Y).",t&&t.length>0&&e.jsxs("span",{className:"block mt-2",children:["Muestras seleccionadas:"," ",e.jsx("strong",{className:"capitalize",children:t.map(a=>a.name).join(", ")})]})]})}),e.jsxs("div",{className:"p-2 relative flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"p-2 md:w-[300px] border border-gray-300 dark:border-gray-950 bg-white dark:bg-gray-600 rounded-lg shadow-lg",children:[g&&g.length>0&&e.jsxs("div",{className:"px-4 mb-4",children:[e.jsx("div",{htmlFor:"charts",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Tipo de gr치ficos"}),e.jsxs("select",{id:"charts",value:A,onChange:a=>Q(a.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",children:[e.jsx("option",{disabled:!0,defaultValue:!0,children:"Elige un tipo de gr치fico"}),e.jsx("option",{value:"bar",children:"Barras"}),e.jsx("option",{value:"column",children:"Columnas"}),e.jsx("option",{value:"area",children:"츼rea"}),V?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"stacked-bar",children:"Barras Apiladas"}),e.jsx("option",{value:"stacked-column",children:"Columnas Apiladas"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"pie",children:"Circular"}),e.jsx("option",{value:"donut",children:"Dona"})]})]})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[450px] flex-1",children:[Y&&O,H]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 justify-end",children:[e.jsx(oe,{name:"Realizar analisis",asyncFunction:W,isLoading:C,full:!0}),e.jsxs("div",{className:"max-w-sm mx-auto mt-4 grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>d(a=>!a),type:"button",className:"mt-2 text-white bg-gradient-to-r  dark:bg-blue-700 dark:to-blue-800 bg-red-octopus-500 hover:bg-red-octopus-700 focus:ring-4 focus:outline-none focus:ring-red-octopus-300 dark:focus:ring-cyan-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:f?"Ver Tabla ":"Ver Grafico"}),e.jsx("button",{type:"button",onClick:()=>U(),className:"mt-2 text-white bg-gradient-to-r  dark:bg-blue-700 dark:to-blue-800 bg-red-octopus-500 hover:bg-red-octopus-700 focus:ring-4 focus:outline-none focus:ring-red-octopus-300 dark:focus:ring-cyan-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:"Invertir Axis"})]})]})]}),e.jsx("div",{className:"flex-1",children:g&&g.length>0?e.jsx("div",{className:"col-span-3 grid grid-cols-1",children:f?e.jsx(ie,{option:I,handleClick:ee}):e.jsx(ne,{data:w.slice(1),columns:m})}):e.jsx("div",{className:"h-full flex border-2 rounded-lg bg-white items-center",children:e.jsx(re,{})})})]})]})};export{Ie as default};
