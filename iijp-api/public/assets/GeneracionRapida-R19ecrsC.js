import{H as B,r as n,j as e,L as R,v as q,c as L,J as A,B as F,K as v,y as I}from"./index-CS51DAse.js";import{a as O}from"./index-B-h8Bjto.js";import{f as T}from"./filterForm-qRQJ7N12.js";import{A as _}from"./AsyncButton-O7CY9z2J.js";import"./Icons-Beyyzlav.js";import"./index-BBE9PvKj.js";import"./index-Bjhrrt2E.js";const z=({currentID:m,setCurrentID:u,setArbol:h})=>{const{nodos:o}=B(),[x,c]=n.useState([]),[l,f]=n.useState(null),p=n.useMemo(()=>e.jsx(O,{className:"w-5 h-5"}),[]),g=t=>{const a=(o||[]).filter(d=>d.id===t);(o||[]).filter(d=>d.descriptor_id===a[0].id).length<=0&&a[0].cantidad===0||(h(d=>[...d,a[0]]),u(a[0].id))},b=()=>{if(l===null)return;const t=(o||[]).filter(a=>a.id===l);h(a=>a.slice(0,-1)),u(t[0].descriptor_id)};return n.useEffect(()=>{if(o&&o.length>0){const t=o.filter(a=>a.descriptor_id===m);f(m),c(t)}},[o,m]),Array.isArray(x)?e.jsxs("div",{className:"m-2 p-2 custom:p-0 custom:m-0",children:[l&&e.jsx("div",{children:e.jsxs("button",{type:"button",onClick:()=>b(),className:"p-4 m-4 rounded-md text-red-octopus-700 bg-gray-100 hover:border-red-octopus-900 hover:bg-gray-200 border border-gray-300 text-xs flex items-center justify-between gap-4",children:[p,"Regresar"]})}),e.jsx("div",{className:"grid grid-cols-1 sm:flex-wrap sm:flex sm:items-center sm:justify-center gap-4",children:x&&x.length>0?x.map(t=>e.jsxs("div",{className:`p-4 text-xs text-center titulo rounded-lg materia-div hover:cursor-pointer max-w-[300px] flex flex-col gap-4 flex-wrap ${t.cantidad>0||(o||[]).some(a=>a.descriptor_id===t.id)?"bg-red-octopus-700  dark:bg-blue-500 dark:hover:bg-blue-700 hover:bg-red-octopus-900 text-white":"bg-gray-100 hidden"}`,id:`tema-${t.id}`,onClick:()=>g(t.id),children:[e.jsx("span",{className:"titulo font-medium text-sm",children:t.nombre}),e.jsxs("span",{className:"text-xs text-gray-300",children:["Cantidad:",t.cantidad]})]},t.id)):e.jsx("div",{className:"text-gray-300",children:"No existen mas nodos"})})]}):e.jsx("div",{className:"flex items-center justify-center",style:{height:800},children:e.jsx(R,{})})},H=()=>{const[m,u]=n.useState(null),[h,o]=n.useState(!1),x=n.useMemo(()=>e.jsx(q,{className:"w-4 h-4 text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"}),[]),[c,l]=n.useState([]),[f,p]=n.useState(""),[g,b]=n.useState(""),[t,a]=n.useState([]),j=s=>!!(/^[a-zA-ZáéíóúÁÉÍÓÚñÑ0-9\s'’-]+$/.test(s)||s===""),d=s=>{const r=s.currentTarget.value;j(r)?(b(r),p("")):p("No se permiten caracteres especiales")},N=()=>{l([]),u(null)},k=async()=>{if(c.length<=0){I.error("Seleccione una materia primero");return}const s=c.map(i=>i.nombre).join(" / "),r=T({tema_id:c[c.length-1].id,descriptor:s});o(!0),v.obtenerCronologia(r).then(({data:i})=>{console.log(i);const y=new Blob([i],{type:"application/pdf"}),E=URL.createObjectURL(y);S("/Jurisprudencia/Cronologias/Resultados",{state:{pdfUrl:E}})}).catch(i=>{const y=i.response?.data?.error||"Ocurrió un error";console.error("Error fetching data:",y)}).finally(()=>{o(!1)})},w=async s=>{try{v.actualizarNodo({busqueda:s}).then(({data:r})=>{r&&(console.log(r),l(r.nodos),u(r.last),a([]))}).catch(({err:r})=>{console.log("Existe un error "+r)})}catch(r){let i="Ocurrió un error";typeof r=="object"&&r!==null&&"response"in r&&(i=r.response?.data?.error||i),console.error("Error fetching data:",i),console.error("Error :",r)}},C=async()=>{if(j(g))try{const s=c.map(({nombre:r})=>r).join(" / ");v.busquedaRapida({busqueda:g,descriptor:s}).then(({data:r})=>{r&&a(r)}).catch(({err:r})=>{console.log("Existe un error "+r),p("No se encontraron resultados"),a([])})}catch(s){let r="Ocurrió un error";typeof s=="object"&&s!==null&&"response"in s&&(r=s.response?.data?.error||r),console.error("Error fetching data:",r),console.error("Error :",s)}},S=L();return e.jsxs("div",{id:"cronologia-container",className:"p-4 m-4",children:[e.jsx("div",{className:"header-container",children:e.jsx("div",{children:e.jsx("p",{className:"text-bold text-3xl text-center my-4 titulo uppercase font-bold text-black dark:text-white",children:"Generación de Cronojurídicas"})})}),e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{children:e.jsxs("div",{children:[e.jsxs("div",{className:"relative w-full mb-4",children:[e.jsx("input",{type:"text",id:"voice-search",value:g,onChange:s=>d(s),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-gray-500 focus:border-gray-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:"Buscar en el árbol jurisprudencial....",required:!0}),e.jsxs("button",{type:"button",onClick:()=>C(),className:"absolute inset-y-0 end-0 flex items-center pe-3",children:[x," "]})]}),f.length>0&&e.jsxs("div",{id:"alert-2",className:"flex items-center p-4 mb-4 text-red-800 rounded-lg  dark:bg-gray-800 dark:text-red-400",role:"alert",children:[e.jsx(A,{className:"shrink-0 w-4 h-4"}),e.jsx("div",{className:"ms-3 text-sm font-medium",children:f})]}),c&&c.length>0&&e.jsxs("div",{className:"p-4 flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"text-sm flex flex-row items-center flex-wrap gap-2",children:[e.jsx("span",{className:"text-black dark:text-white",children:"Filtrado por:"}),e.jsxs("div",{onClick:()=>N(),className:"bg-white group flex gap-4 items-center justify-between hover:cursor-pointer rounded-lg p-2 font-bold m-4 border hover:border-red-500 text-xs dark:bg-gray-500",children:[e.jsx("span",{children:c.map(({nombre:s})=>s).join(" / ")}),e.jsx(F,{className:"group-hover:text-red-500"})]})]}),e.jsx(_,{asyncFunction:k,name:"Obtener Resoluciones",isLoading:h,full:!1})]}),e.jsx("div",{className:"p-4",children:t&&t.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-800 rounded-md p-3 my-2",children:[e.jsxs("span",{children:["La búsqueda genero:"," ",t.length>1?t.length+" resultados":"un resultado"]}),e.jsx("span",{onClick:()=>a([]),className:"cursor-pointer underline",children:"Limpiar Resultados"})]}),t.map((s,r)=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-50 dark:bg-gray-700 hover:dark:bg-gray-700 hover:bg-gray-200 rounded-md p-3 my-2 cursor-pointer transition-all ease-in-out duration-200",onClick:()=>w(s.descriptor),children:[e.jsx("span",{className:"text-black font-semibold dark:text-white ",children:s.descriptor}),e.jsx("span",{className:"text-gray-600 text-sm dark:text-gray-400",children:s.cantidad})]},r))]}):e.jsx(z,{currentID:m,setCurrentID:u,setArbol:l})})]})})})]})};export{H as default};
