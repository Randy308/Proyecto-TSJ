import{r as l,j as e,y as L,X as T,c as $,a as G,x as O,L as Q}from"./index-CS51DAse.js";import{A as U}from"./AsyncButton-O7CY9z2J.js";import{a as _,T as J,i as K}from"./arrayUtils-_cr7Npey.js";import{S as H,O as W}from"./OptionChart-Dv3jTv_h.js";import{u as F}from"./Icons-Beyyzlav.js";import{u as E}from"./useSessionStorage-CBqBFoCV.js";import"./MultiBtnDropdown-oYVBAFdf.js";import"./filterForm-qRQJ7N12.js";import"./dark-Bdao2Wg9.js";import"./index-BBE9PvKj.js";import"./index-Bjhrrt2E.js";const Z=({name:n,listaX:r,setListaX:f,contenido:A,agregarTermino:v,size:j=6})=>{const[t]=l.useState(2),{removeAllIcon:N,checkAllIcon:y}=F(),x=o=>{const u=o.target.name;f(m=>{const i=m.find(h=>h.name===n);if(i){if(i.ids.length>=j&&!i.ids.includes(u))return L.warning(`No se pueden agregar m치s de ${j} variables. Quite alguna antes de agregar.`),m;const h=i.ids.includes(u)?i.ids.filter(g=>g!==u):[...i.ids,u];return h.length===0?m.filter(g=>g.name!==n):m.map(g=>g.name===n?{...g,ids:h}:g)}else return m.length<t?[...m,{name:n,ids:[u]}]:(L.error(`No se puede agregar m치s de ${t} variables. Por favor, elimine alguna.`),m)})},S=()=>{f(o=>o.filter(u=>u.name!==n))},C=()=>{f(o=>{const u=(o??[]).find(i=>i.name===n),m={name:n,ids:A.slice(0,j).map(i=>i.nombre)};return u?(o??[]).map(i=>i.name===n?m:i):(o??[]).length<t?[...o??[],m]:(L.warning(`No se pueden agregar m치s de ${t} variables.`),o)})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-1 mb-4 px-2 sm:text-xs max-h-[600px] overflow-y-scroll",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 sm:text-xs",children:[e.jsxs("a",{onClick:()=>C(),className:"dark:bg-gray-800 dark:border-gray-700 inline-flex items-center justify-between border hover:cursor-pointer border-gray-200 p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700",children:[y,e.jsx("span",{className:"ms-2 text-xs",children:j===9?"Seleccionar todos":"Seleccionar varios"})]}),e.jsxs("a",{onClick:()=>S(),className:"dark:bg-gray-800 dark:border-gray-700 inline-flex items-center border hover:cursor-pointer border-gray-200 p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group",children:[N,e.jsx("span",{className:"ms-2 text-xs",children:"Quitar Selecci칩n"})]})]}),e.jsxs("ul",{className:"flex-1 grid grid-cols-1 py-4",children:[A.map(o=>e.jsxs("li",{className:"p-1 flex items-center",children:[e.jsx("input",{type:"checkbox",id:o.nombre+n,name:o.nombre,value:o.nombre,className:"peer hidden",checked:r.some(u=>u.name===n&&u.ids.includes(o.nombre)),onChange:x}),e.jsx("label",{htmlFor:o.nombre+n,className:"w-full p-2 cursor-pointer rounded-sm dark:hover:text-gray-300 dark:border-gray-700 peer-checked:bg-gray-50  peer-checked:text-red-octopus-500 peer-checked:border-l-4 peer-checked:border-red-octopus-500 hover:text-gray-600 dark:peer-checked:text-gray-300 text-sm peer-checked:dark:bg-gray-900 hover:bg-gray-50 dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-700 capitalize",children:o.nombre})]},o.nombre)),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>v(),className:"w-full text-white end-2.5 bottom-2.5 bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 text-xs",children:"Cargar mas"})})]})]})})},ee=[{tabla:"resolutions",columna:"precedente",nombre:"Precedente",busqueda:!0},{tabla:"resolutions",columna:"proceso",nombre:"Proceso",busqueda:!0},{tabla:"resolutions",columna:"maxima",nombre:"Maxima",busqueda:!0},{tabla:"resolutions",columna:"sintesis",nombre:"S칤ntesis",busqueda:!0},{tabla:"jurisprudencias",columna:"restrictor",nombre:"Restrictor",busqueda:!0},{tabla:"jurisprudencias",columna:"ratio",nombre:"Ratio",busqueda:!0}],ae=({listaX:n,setListaX:r})=>{const{arrowUpIcon:f,arrowDownIcon:A,trashIcon:v,spinIcon:j}=F(),[t,N]=l.useState(null),[y,x]=l.useState([]),[S,C]=l.useState(null),[o,u]=l.useState({}),[m,i]=l.useState(!1),[h,g]=l.useState({}),M=()=>{if(t&&n.some(s=>s.name===t.columna)){let s=h[t.columna]?h[t.columna].page:1;s=s+1;const p=h[t.columna]?h[t.columna].last:1;if(s>=p){alert("No hay mas terminos para agregar");return}T.obtenerTerminos({nombre:t.columna,page:s}).then(({data:c})=>{const w=[...y,...c.data];x(w),u(D=>({...D,[t.columna]:w})),g(D=>({...D,[t.columna]:{page:c.current_page,last:c.last_page}}))}).catch(c=>{console.error("Error fetching data",c)}).finally(()=>{i(!1),C(null)})}},k=s=>{console.log(n);const p=n.filter(c=>c.name!==s);r(p)},I=(s,p=1)=>{if(t&&s.columna===t.columna){x([]),N(null);return}o[s.columna]?(x(o[s.columna]),N(s)):(i(!0),C(s.columna),T.obtenerTerminos({nombre:s.columna,page:p}).then(({data:c})=>{x(c.data),u(w=>({...w,[s.columna]:c.data})),g(w=>({...w,[s.columna]:{page:c.current_page,last:c.last_page}})),N(s)}).catch(c=>{console.error("Error fetching data",c)}).finally(()=>{i(!1),C(null)}))};return e.jsx("div",{children:ee.map((s,p)=>e.jsxs("div",{children:[e.jsxs("div",{className:"p-2 rounded-lg border flex items-center justify-between text-sm  me-2 mb-2 ",children:[e.jsx("div",{className:"text-xs sm:text-sm text-black dark:text-gray-200",children:s.nombre}),e.jsxs("div",{className:"flex gap-4",children:[n&&n.length>0&&n.some(c=>c.name===s.columna)&&e.jsx("button",{className:"p-2 bg-red-500 rounded-lg hover:bg-red-600 cursor-pointer ",onClick:()=>k(s.columna),children:v}),e.jsx("button",{className:"p-2 rounded-lg cursor-pointer border border-gray-400 dark:border-gray-600",onClick:()=>I(s),children:t&&t.columna===s.columna?f:m&&S===s.columna?j:A})]})]}),t&&t.columna===s.columna&&y.length>0&&e.jsx(Z,{listaX:n,setListaX:r,contenido:y,name:s.columna,agregarTermino:M})]},p))})},ge=()=>{const n=l.useMemo(()=>2,[]),[r,f]=l.useState([]),[A,v]=l.useState(!1),j=$(),{data:t}=G(),[N,y]=l.useState("bar"),[x,S]=E("analisis_xy",[]),[C,o]=l.useState([]),[,u]=E("serie",[]),[,m]=E("mapa",[]),[i,h]=l.useState(!0),[g,M]=l.useState(!1),[k,I]=l.useState([]),p=O().state?.params,c=l.useMemo(()=>{if(t){const{periodo:a,...d}=t;return d}return{departamento:[],sala:[],tipo_jurisprudencia:[],tipo_resolucion:[],forma_resolucion:[],magistrado:[],materia:[]}},[t]),w=a=>{y(a)},D=()=>{y("column"),I(K(k))};l.useEffect(()=>{if(k&&k.length>0){const a=k[0];o(a.map((d,V)=>({accessorKey:V.toString(),header:String(d).replace(/_/g," ").replace(/\b\w/g,b=>b.toUpperCase()),enableSorting:!0})))}console.log(k)},[k]);const P=async()=>{if(r.length===0)return;v(!0);const a=r.length>1,d=a?{nombre:r[0].name,variable:r[0].ids,nombreY:r[1].name,variableY:r[1].ids}:{nombre:r[0].name,variable:r[0].ids};(a?T.getStatsXY(d):T.getStatsX(d)).then(({data:b})=>{console.log("Datos cargados desde API",b),b&&(S(b.data.length>0?b.data:[]),M(b.multiVariable),I(b.data.length>0?_(b.data):[]),m([]),u([]))}).catch(b=>{console.error("Error fetching data:",b)}).finally(()=>{y("bar"),v(!1)})},Y=()=>{if(r.length===0)return;const a={nombre:r[0].name,variable:r[0].ids};j(`/serie-temporal/${a.nombre}`,{state:{params:a}})},q=l.useMemo(()=>e.jsx(H,{memoizedParams:c,limite:n,listaX:r,setListaX:f}),[c,n,r]),B=l.useMemo(()=>e.jsx(ae,{setListaX:f,listaX:r}),[r]),R=l.useMemo(()=>P,[r]),X=()=>{if(r.length===0)return;const a={nombre:r[0].name,variable:r[0].ids};if(a.nombre==="departamento"){L.warning("No se puede realizar un an치lisis por departamento, por favor seleccione una variable diferente.");return}j("/mapa-estadistico/"+a.nombre,{state:{validatedData:a}})};l.useEffect(()=>{if(p&&Array.isArray(p.variable)){const a={name:p.nombre,ids:p.variable};if(f([a]),x&&x.length>0)return;v(!0),T.getStatsX(p).then(({data:d})=>{console.log("Datos cargados desde API",d),d&&(S(d.data.length>0?d.data:[]),M(d.multiVariable),I(d.data.length>0?_(d.data):[]))}).catch(d=>{console.error("Error fetching data:",d)}).finally(()=>{v(!1)})}else S([]),m([]),u([])},[p]);const z=l.useCallback(a=>{if(g&&a.seriesName!=="Cantidad"&&a.name!=="Cantidad"){const d={nameX:r[0].name,valueX:a.name,nameY:r[1].name,valueY:a.seriesName};console.log("Clicked on series:",d)}else if(a.seriesName==="Cantidad"||a.name==="Cantidad"){const d={nameX:r[0].name,valueX:a.name!="Cantidad"?a.name:a.seriesName};console.log("Clicked on series:",d)}},[g]);return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-4 text-sm",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"flex flex-row flex-wrap gap-2 items-center justify-center p-4 mb-4",children:[e.jsx("button",{onClick:()=>X(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-sky-600 to-blue-700 hover:from-sky-700 hover:to-blue-800 shadow-md transition-all",children:"ir a Mapa Geogr치fico"}),e.jsx("button",{onClick:()=>Y(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-md transition-all",children:"ir a Serie de Tiempo"})]})})}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-800 dark:text-blue-300 text-sm leading-relaxed",children:["游눠 ",e.jsx("strong",{children:"Instrucciones:"})," Seleccione una o dos"," ",e.jsx("strong",{children:"categor칤as"})," para generar el an치lisis estad칤stico. Puede agregar hasta ",e.jsx("strong",{children:"6 variables"})," por cada dimensi칩n del an치lisis (X o Y).",r&&r.length>0&&e.jsxs("span",{className:"block mt-2",children:["Muestras seleccionadas:"," ",e.jsx("strong",{className:"capitalize",children:r.map(a=>a.name).join(", ")})]})]})}),e.jsxs("div",{className:"p-2 relative flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"p-2 md:w-[300px] border border-gray-300 dark:border-gray-950 bg-white dark:bg-gray-600 rounded-lg shadow-lg",children:[x&&x.length>0&&e.jsxs("div",{className:"px-4 mb-4",children:[e.jsx("div",{className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Tipo de gr치ficos"}),e.jsxs("select",{id:"charts",value:N,onChange:a=>w(a.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",children:[e.jsx("option",{disabled:!0,defaultValue:"",children:"Elige un tipo de gr치fico"}),g?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"bar",children:"Barras Agrupadas"}),e.jsx("option",{value:"stackedBar",children:"Barras Apiladas"}),e.jsx("option",{value:"stackedColumn",children:"Columnas Apiladas"}),e.jsx("option",{value:"column",children:"Columnas Agrupadas"}),e.jsx("option",{value:"multiLine",children:"Lineas Multiples"}),e.jsx("option",{value:"stackedArea",children:"츼rea Apilada"}),e.jsx("option",{value:"polar",children:"Polar"}),e.jsx("option",{value:"radar",children:"Radar"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"bar",children:"Barras"}),e.jsx("option",{value:"column",children:"Columnas"}),e.jsx("option",{value:"area",children:"츼rea"}),e.jsx("option",{value:"scatter",children:"Dispersi칩n"}),e.jsx("option",{value:"line",children:"Lineas"}),e.jsx("option",{value:"pie",children:"Circular"}),e.jsx("option",{value:"donut",children:"Dona"})]})]})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[450px] flex-1",children:[c&&q,B]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 justify-end",children:[e.jsx(U,{name:"Realizar analisis",asyncFunction:R,isLoading:A,full:!0}),e.jsxs("div",{className:"max-w-sm mx-auto mt-4 grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>h(a=>!a),type:"button",className:"mt-2 text-white bg-gradient-to-r  dark:bg-blue-700 dark:to-blue-800 bg-red-octopus-500 hover:bg-red-octopus-700 focus:ring-4 focus:outline-none focus:ring-red-octopus-300 dark:focus:ring-cyan-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:i?"Ver Tabla ":"Ver Grafico"}),e.jsx("button",{type:"button",onClick:()=>D(),className:"mt-2 text-white bg-gradient-to-r  dark:bg-blue-700 dark:to-blue-800 bg-red-octopus-500 hover:bg-red-octopus-700 focus:ring-4 focus:outline-none focus:ring-red-octopus-300 dark:focus:ring-cyan-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:"Invertir Axis"})]})]})]}),e.jsx("div",{className:"flex-1",children:x&&x.length>0?e.jsx("div",{className:"col-span-3 grid grid-cols-1",children:i?e.jsx(W,{dataset:x,chartType:N,isMultiVariable:g,handleClick:z}):e.jsx(J,{data:k.slice(1),columns:C})}):e.jsx("div",{className:"h-full flex border-2 rounded-lg bg-white items-center",children:e.jsx(Q,{})})})]})]})};export{ge as default};
