import{r as o,j as e,y as O,b as te,u as re,E as oe,L as ne}from"./index-DfKAKSSO.js";import{A as le}from"./AsyncButton-DiTkpQVw.js";import{S as F}from"./StatsService-CJTEx-IJ.js";import{T as ie,t as ce}from"./math-CatLmZRW.js";import{S as de}from"./SimpleChart-CfrclA1U.js";import{S as ue,a as B}from"./Select-Cqm4wJik.js";import{u as G}from"./Icons-AMBJMzXu.js";import{u as q}from"./useSessionStorage-BciEVf3a.js";import"./dark-CE_-lrH1.js";import"./MultiBtnDropdown-CPY46KGv.js";import"./filterForm-BY0rdyPp.js";import"./index-CvxPIX6S.js";import"./index-DbfdK6-c.js";const me=({name:l,tabla:M,listaX:t,setListaX:k,contenido:A,agregarTermino:N,size:i=6})=>{const[h,I]=o.useState(2),{removeAllIcon:p,checkAllIcon:g}=G(),v=n=>{const u=n.target.name;k(m=>{const c=m.find(C=>C.name===l);if(c){if(c.ids.length>=i&&!c.ids.includes(u))return O.warning(`No se pueden agregar m치s de ${i} variables. Quite alguna antes de agregar.`),m;const C=c.ids.includes(u)?c.ids.filter(x=>x!==u):[...c.ids,u];return C.length===0?m.filter(x=>x.name!==l):m.map(x=>x.name===l?{...x,ids:C}:x)}else return m.length<h?[...m,{name:l,tabla:M,ids:[u]}]:(O.error(`No se puede agregar m치s de ${h} variables. Por favor, elimine alguna.`),m)})},L=()=>{k(n=>n.filter(u=>u.name!==l))},S=()=>{k(n=>{const u=n.find(c=>c.name===l),m={name:l,ids:A.slice(0,i).map(c=>c.nombre)};return u?n.map(c=>c.name===l?m:c):n.length<h?[...n,m]:(O.warning(`No se pueden agregar m치s de ${h} variables.`),n)})};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"flex flex-col gap-1 mb-4 px-2 sm:text-xs max-h-[600px] overflow-y-scroll",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 sm:text-xs",children:[e.jsxs("a",{onClick:()=>S(),className:"dark:bg-gray-800 dark:border-gray-700 inline-flex items-center justify-between border hover:cursor-pointer border-gray-200 p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700",children:[g,e.jsx("span",{className:"ms-2 text-xs",children:i===9?"Seleccionar todos":"Seleccionar varios"})]}),e.jsxs("a",{onClick:()=>L(),className:"dark:bg-gray-800 dark:border-gray-700 inline-flex items-center border hover:cursor-pointer border-gray-200 p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group",children:[p,e.jsx("span",{className:"ms-2 text-xs",children:"Quitar Selecci칩n"})]})]}),e.jsxs("ul",{className:"flex-1 grid grid-cols-1 py-4",children:[A.map(n=>e.jsxs("li",{className:"p-1 flex items-center",children:[e.jsx("input",{type:"checkbox",id:n.nombre+l,name:n.nombre,value:n.nombre,className:"peer hidden",checked:t.some(u=>u.name===l&&u.ids.includes(n.nombre)),onChange:v}),e.jsx("label",{htmlFor:n.nombre+l,className:"w-full p-2 cursor-pointer rounded-sm dark:hover:text-gray-300 dark:border-gray-700 peer-checked:bg-gray-50  peer-checked:text-red-octopus-500 peer-checked:border-l-4 peer-checked:border-red-octopus-500 hover:text-gray-600 dark:peer-checked:text-gray-300 text-sm peer-checked:dark:bg-gray-900 hover:bg-gray-50 dark:text-gray-400 dark:bg-gray-700 dark:hover:bg-gray-700 capitalize",children:n.nombre})]},n.nombre)),e.jsx("div",{className:"mt-4",children:e.jsx("button",{type:"button",onClick:()=>N(),className:"w-full text-white end-2.5 bottom-2.5 bg-gray-700 hover:bg-gray-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-medium rounded-lg px-4 py-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 text-xs",children:"Cargar mas"})})]})]})})},ge=[{tabla:"resolutions",columna:"precedente",nombre:"Precedente",busqueda:!0},{tabla:"resolutions",columna:"proceso",nombre:"Proceso",busqueda:!0},{tabla:"resolutions",columna:"maxima",nombre:"Maxima",busqueda:!0},{tabla:"resolutions",columna:"sintesis",nombre:"S칤ntesis",busqueda:!0},{tabla:"jurisprudencias",columna:"restrictor",nombre:"Restrictor",busqueda:!0},{tabla:"jurisprudencias",columna:"ratio",nombre:"Ratio",busqueda:!0}],be=({listaX:l,setListaX:M})=>{const{arrowUpIcon:t,arrowDownIcon:k,trashIcon:A,spinIcon:N}=G(),[i,h]=o.useState(null),[I,p]=o.useState([]),[g,v]=o.useState(null),[L,S]=o.useState({}),[n,u]=o.useState(!1),[m,c]=o.useState([]),C=()=>{let r=m[i.columna]?m[i.columna].page:1;r=r+1;const f=m[i.columna]?m[i.columna].last:1;if(r>=f){alert("No hay mas terminos para agregar");return}F.obtenerTerminos({nombre:i.columna,page:r}).then(({data:d})=>{const b=[...I,...d.data];p(b),S(T=>({...T,[i.columna]:b})),c(T=>({...T,[i.columna]:{page:d.current_page,last:d.last_page}}))}).catch(d=>{console.error("Error fetching data",d)}).finally(()=>{u(!1),v(null)})},x=r=>{console.log(l);const f=l.filter(d=>d.name!==r);M(f)},Y=(r,f=1)=>{if(i&&r.columna===i.columna){p([]),h(null);return}L[r.columna]?(p(L[r.columna]),h(r)):(u(!0),v(r.columna),F.obtenerTerminos({nombre:r.columna,page:f}).then(({data:d})=>{p(d.data),S(b=>({...b,[r.columna]:d.data})),c(b=>({...b,[r.columna]:{page:d.current_page,last:d.last_page}})),h(r)}).catch(d=>{console.error("Error fetching data",d)}).finally(()=>{u(!1),v(null)}))};return e.jsx("div",{children:ge.map((r,f)=>e.jsxs("div",{children:[e.jsxs("div",{className:"p-2 rounded-lg border flex items-center justify-between text-sm  me-2 mb-2 ",children:[e.jsx("div",{className:"text-xs sm:text-sm text-black dark:text-gray-200",children:r.nombre}),e.jsxs("div",{className:"flex gap-4",children:[l&&l.length>0&&l.some(d=>d.name===r.columna)&&e.jsx("button",{className:"p-2 bg-red-500 rounded-lg hover:bg-red-600 cursor-pointer ",onClick:()=>x(r.columna),children:A}),e.jsx("button",{className:"p-2 rounded-lg cursor-pointer border border-gray-400 dark:border-gray-600",onClick:()=>Y(r),children:i&&i.columna===r.columna?t:n&&g===r.columna?N:k})]})]}),i&&i.columna===r.columna&&I.length>0&&e.jsx(me,{listaX:l,setListaX:M,contenido:I,tabla:r.tabla,name:r.columna,agregarTermino:C})]},f))})},Te=()=>{const[l,M]=o.useState(2),[t,k]=o.useState([]),[A,N]=o.useState(!1),i=te(),{data:h}=re(),[I,p]=o.useState(),[g,v]=q("analisis_xy",[]),[L,S]=o.useState({}),[n,u]=o.useState("nombre"),[m,c]=o.useState(null),[C,x]=q("serie",[]),[Y,r]=q("mapa",[]),[f,d]=o.useState(!0),[b,T]=o.useState([]),[V,_]=o.useState(!1),[xe,R]=o.useState(0),E=oe().state?.params,P=o.useMemo(()=>{const{periodo:a,...s}=h||{};return s},[h]),X=a=>{const s=[];for(let w=0;w<a;w++)s.push({type:"bar",seriesLayoutBy:"column"});return s};o.useEffect(()=>{if(g&&g.length>0){const a={[n]:"Total"},s=V?g.map(j=>{const D=Object.entries(j).reduce((z,[ae,se])=>ae!==n?z+se:z,0);return{...j,Total:D}}):g;s.forEach(j=>{Object.keys(j).forEach(D=>{D!==n&&(a[D]=(a[D]||0)+j[D])})}),T([...s,a]);const w=Object.keys(g[0]).map(j=>j.charAt(0).toUpperCase()+j.slice(1)),y=s.map(j=>Object.values(j));S({legend:{},tooltip:{trigger:"item"},grid:{containLabel:!0},dataset:{source:[w,...y]},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!0},yAxis:{},series:X(w.length-1)})}},[g]);const $=a=>{p(a),S(s=>B(s,a.toLowerCase()))},J=()=>{p("column"),S(s=>B(s,"column",!0));const a=ce(b);console.log(a),T(a)};o.useEffect(()=>{if(b&&b.length>0){let a=Object.keys(b[0]);c(a.map(s=>({accessorKey:s,header:s.replace(/_/g," ").replace(/\b\w/g,w=>w.toUpperCase()),enableSorting:!0})))}},[b]);const U=()=>{if(t.length===0)return;N(!0);const a=t.length>1,s=a?{nombre:t[0].name,variable:btoa(JSON.stringify(t[0].ids)),nombreY:t[1].name,variableY:btoa(JSON.stringify(t[1].ids))}:{nombre:t[0].name,variable:t[0].ids};(a?F.getStatsXY(s):F.getStatsX(s)).then(({data:y})=>{console.log("Datos cargados desde API",y),y&&(v(y.data.length>0?y.data:[]),_(y.multiVariable),R(y.total),r([]),x([]))}).catch(y=>{console.error("Error fetching data:",y)}).finally(()=>{p("bar"),N(!1)})},Q=()=>{if(t.length===0)return;const a={nombre:t[0].name,variable:t[0].ids};i(`/serie-temporal/${a.nombre}`,{state:{params:a}})},K=o.useMemo(()=>e.jsx(ue,{memoizedParams:P,limite:l,listaX:t,setListaX:k}),[P,l,t]),H=o.useMemo(()=>e.jsx(be,{setListaX:k,listaX:t}),[t]),W=o.useMemo(()=>U,[t]),Z=()=>{if(t.length===0)return;const a={nombre:t[0].name,variable:t[0].ids};if(a.nombre==="departamento"){O.warning("No se puede realizar un an치lisis por departamento, por favor seleccione una variable diferente.");return}i("/mapa-estadistico/"+a.nombre,{state:{validatedData:a}})};o.useEffect(()=>{if(E&&Array.isArray(E.variable)){const a={name:E.nombre,ids:E.variable};if(k([a]),g&&g.length>0)return;N(!0),F.getStatsX(E).then(({data:s})=>{console.log("Datos cargados desde API",s),s&&(v(s.data.length>0?s.data:[]),_(s.multiVariable))}).catch(s=>{console.error("Error fetching data:",s)}).finally(()=>{N(!1)})}else v([]),r([]),x([])},[E]);const ee=o.useCallback(a=>{if(V&&a.seriesName!=="Cantidad"&&a.name!=="Cantidad"){const s={nameX:t[0].name,valueX:a.name,nameY:t[1].name,valueY:a.seriesName};console.log("Clicked on series:",s)}else if(a.seriesName==="Cantidad"||a.name==="Cantidad"){const s={nameX:t[0].name,valueX:a.name!="Cantidad"?a.name:a.seriesName};console.log("Clicked on series:",s)}},[V]);return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-4 text-sm",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"flex flex-row flex-wrap gap-2 items-center justify-center p-4 mb-4",children:[e.jsx("button",{onClick:()=>Z(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-sky-600 to-blue-700 hover:from-sky-700 hover:to-blue-800 shadow-md transition-all",children:"ir a Mapa Geogr치fico"}),e.jsx("button",{onClick:()=>Q(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-purple-600 to-indigo-700 hover:from-purple-700 hover:to-indigo-800 shadow-md transition-all",children:"ir a Serie de Tiempo"})]})})}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-800 dark:text-blue-300 text-sm leading-relaxed",children:["游눠 ",e.jsx("strong",{children:"Instrucciones:"})," Seleccione una o dos"," ",e.jsx("strong",{children:"categor칤as"})," para generar el an치lisis estad칤stico. Puede agregar hasta ",e.jsx("strong",{children:"6 variables"})," por cada dimensi칩n del an치lisis (X o Y).",t&&t.length>0&&e.jsxs("span",{className:"block mt-2",children:["Muestras seleccionadas:"," ",e.jsx("strong",{className:"capitalize",children:t.map(a=>a.name).join(", ")})]})]})}),e.jsxs("div",{className:"p-2 relative flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"p-2 md:w-[300px] border border-gray-300 dark:border-gray-950 bg-white dark:bg-gray-600 rounded-lg shadow-lg",children:[g&&g.length>0&&e.jsxs("div",{className:"px-4 mb-4",children:[e.jsx("div",{htmlFor:"charts",className:"block mb-2 text-sm font-medium text-gray-900 dark:text-white",children:"Tipo de gr치ficos"}),e.jsxs("select",{id:"charts",value:I,onChange:a=>$(a.target.value),className:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",children:[e.jsx("option",{disabled:!0,defaultValue:!0,children:"Elige un tipo de gr치fico"}),e.jsx("option",{value:"bar",children:"Barras"}),e.jsx("option",{value:"column",children:"Columnas"}),e.jsx("option",{value:"area",children:"츼rea"}),V?e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"stacked-bar",children:"Barras Apiladas"}),e.jsx("option",{value:"stacked-column",children:"Columnas Apiladas"})]}):e.jsxs(e.Fragment,{children:[e.jsx("option",{value:"pie",children:"Circular"}),e.jsx("option",{value:"donut",children:"Dona"})]})]})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[450px] flex-1",children:[P&&K,H]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-4 pt-4 justify-end",children:[e.jsx(le,{name:"Realizar analisis",asyncFunction:W,isLoading:A,full:!0}),e.jsxs("div",{className:"max-w-sm mx-auto mt-4 grid grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>d(a=>!a),type:"button",className:"mt-2 text-white bg-gradient-to-r  dark:bg-blue-700 dark:to-blue-800 bg-red-octopus-500 hover:bg-red-octopus-700 focus:ring-4 focus:outline-none focus:ring-red-octopus-300 dark:focus:ring-cyan-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:f?"Ver Tabla ":"Ver Grafico"}),e.jsx("button",{type:"button",onClick:()=>J(),className:"mt-2 text-white bg-gradient-to-r  dark:bg-blue-700 dark:to-blue-800 bg-red-octopus-500 hover:bg-red-octopus-700 focus:ring-4 focus:outline-none focus:ring-red-octopus-300 dark:focus:ring-cyan-800 font-medium rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2",children:"Invertir Axis"})]})]})]}),e.jsx("div",{className:"flex-1",children:g&&g.length>0?e.jsx("div",{className:"col-span-3 grid grid-cols-1",children:f?e.jsx(de,{option:L,handleClick:ee}):e.jsx(ie,{data:b,columns:m})}):e.jsx("div",{className:"h-full flex border-2 rounded-lg bg-white items-center",children:e.jsx(ne,{})})})]})]})};export{Te as default};
