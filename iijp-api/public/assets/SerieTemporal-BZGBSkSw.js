import{P as O,r,j as e,x as R,c as M,X,y as z}from"./index-CS51DAse.js";import{f as U,a as G,o as K,T as V,i as Y}from"./arrayUtils-_cr7Npey.js";import{E as $}from"./dark-Bdao2Wg9.js";import{u as p}from"./useSessionStorage-CBqBFoCV.js";const q=({option:d,border:n=!0,handleClick:o=()=>{}})=>{const{isDark:x}=O(),g=r.useRef(null),m={click:o,updateAxisPointer:s=>{const l=g.current?.getEchartsInstance?.();if(!l)return;const a=s.axesInfo?.[0];if(!a)return;const c=a.value+1;l.setOption({series:{id:"pie",label:{formatter:`{b}: {@[${c}]} ({d}%)`},encode:{value:c,tooltip:c}}})}};return e.jsx("div",{className:`p-2 m-2 rounded-xl bg-white dark:bg-[#100C2A] h-[600px] ${n?"border shadow-lg border-gray-300 dark:border-gray-800":""}`,children:e.jsx($,{option:d,theme:x?"dark":void 0,style:{height:"100%",width:"100%"},onEvents:m,ref:g},JSON.stringify(d))})},_=()=>{const d=R(),n=M(),o=d.state?.params,[x,g]=r.useState(""),[i,m]=r.useState([]),[s,l]=r.useState([]),[a,c]=p("serie",[]),[h,b]=p("total-serie",0),[f,v]=r.useState([]),[u,j]=r.useState(!0),[y,N]=r.useState([]),k={legend:{},tooltip:{trigger:"axis",showContent:!1},dataset:{source:i},xAxis:{type:"category"},yAxis:{gridIndex:0},grid:{top:"55%"},series:[...f,{type:"pie",id:"pie",radius:"30%",center:["50%","25%"],emphasis:{focus:"self"},label:{formatter:"{b}: {@2012} ({d}%)"},encode:{itemName:"nombre",value:"2012",tooltip:"2012"}}]},S=()=>{l(Y(s))},w=t=>{t.componentSubType==="line"&&g(t.name)},A=()=>{if(o.nombre==="departamento"){z.warning("No se puede realizar un an치lisis por departamento, por favor seleccione una variable diferente.");return}n("/mapa-estadistico/"+o.nombre,{state:{validatedData:o}})},E=()=>{n("/analisis-avanzado/",{state:{params:o}})};r.useEffect(()=>{!o||!Array.isArray(o.variable)?n("/analisis-avanzado"):C()},[o]);const C=()=>{if(a.length>0){console.log("Datos ya cargados, no se vuelve a cargar");return}X.getTimeSeries(o).then(({data:t})=>{console.log("Datos cargados desde API",t),t&&(c(t.data.length>0?t.data:[]),b(t.total))}).catch(t=>{console.error("Error fetching data:",t)})};r.useEffect(()=>{m(a.length>0?U(a,h,.1):[]),l(a.length>0?G(a):[])},[a]),r.useEffect(()=>{if(!i||Object.keys(i).length===0)return;const t=Object.keys(i).splice(1);v(t.map(()=>({type:"line",smooth:!0,seriesLayoutBy:"row",emphasis:{focus:"series"}})))},[i]),r.useEffect(()=>{if(s&&s.length>0){const t=s[0];N(t.map((P,I)=>({accessorKey:I.toString(),header:String(P).replace(/_/g," ").replace(/\b\w/g,L=>L.toUpperCase()),enableSorting:!0})))}},[s]);const{mean:D,stdDev:T}=r.useMemo(()=>{const t=K(s);return{mean:t.mean||0,stdDev:t.stdDev||0}},[s]);return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsx("div",{className:"flex items-center justify-end gap-4 text-sm",children:e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:e.jsxs("div",{className:"flex flex-row flex-wrap gap-2 items-center justify-center p-4 mb-4",children:[e.jsx("button",{onClick:()=>A(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-sky-600 to-blue-700 hover:from-sky-700 hover:to-blue-800 shadow-md transition-all",children:"ir a Mapa Geogr치fico"}),e.jsx("button",{onClick:()=>E(),className:"flex items-center gap-2 px-4 py-2 rounded-xl text-white bg-gradient-to-r from-pink-600 to-red-octopus-600 hover:from-pink-700 hover:to-red-octopus-800 shadow-md transition-all",children:"ir a An치lisis X-Y"})]})})}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200",children:"Estad칤sticas Generales"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 text-sm",children:[e.jsxs("div",{className:"text-center",children:[a.length>0&&e.jsx("div",{className:"font-bold text-xl text-blue-600 dark:text-blue-400",children:a[0].length-1}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Periodos"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-xl text-green-600 dark:text-green-400",children:h.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Total Resoluciones"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"font-bold text-xl text-purple-600 dark:text-purple-400",children:(a.length-1).toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Categor칤as"})]}),e.jsxs("div",{className:"text-center",children:[s.length>0&&e.jsx("div",{className:"font-bold text-xl text-orange-600 dark:text-orange-400",children:D.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Promedio"})]}),e.jsxs("div",{className:"text-center",children:[s.length>0&&e.jsx("div",{className:"font-bold text-xl text-orange-600 dark:text-orange-400",children:T.toLocaleString()}),e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:"Desviaci칩n Est치ndar"})]})]})]}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:e.jsxs("p",{className:"text-blue-800 dark:text-blue-300 text-sm",children:["游눠 ",e.jsx("strong",{children:"Instrucciones:"})," Haga clic en cualquier periodo de la serie de tiempo para ver su distribuci칩n detallada en el gr치fico circular.",x&&e.jsxs("span",{className:"block mt-1",children:["Mostrando datos de: ",e.jsx("strong",{children:x})]})]})}),e.jsxs("div",{className:"grid mt-4 grid-cols-1 sm:grid-cols-4 md:grid-cols-5 px-4 gap-2",children:[e.jsxs("div",{className:"p-2 bg-white dark:bg-gray-700 rounded-lg shadow-lg border-2 dark:border-gray-700 flex flex-col gap-4",children:[e.jsx("button",{onClick:()=>j(t=>!t),className:"p-2 mt-4 rounded-lg text-white bg-red-octopus-600 hover:bg-red-octopus-800 sm:w-full",children:u?"Ver Tabla":"Ver gr치fico"}),!u&&e.jsx("button",{onClick:()=>S(),className:"p-2 rounded-lg text-white bg-red-octopus-600 hover:bg-red-octopus-800 sm:w-full",children:"Invertir tabla"})]}),e.jsx("div",{className:"sm:col-span-3 md:col-span-4",children:u?e.jsx(q,{option:k,handleClick:w}):e.jsx(V,{data:s.slice(1),columns:y})})]})]})};export{_ as default};
